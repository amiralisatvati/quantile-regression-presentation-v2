<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رگرسیون کوانتایل - دانشگاه فردوسی مشهد</title>
    <!-- KaTeX for mathematical formulas -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <!-- SEO & Social Media -->
    <meta name="description" content="ارائه حرفه‌ای رگرسیون کوانتایل - دانشگاه فردوسی مشهد">
    <meta name="author" content="امیرعلی سطوتی">
    <meta property="og:title" content="رگرسیون کوانتایل - Quantile Regression">
    <meta property="og:description" content="ارائه تعاملی رگرسیون کوانتایل با ۳۵ اسلاید">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #0f172a;
            --light: #f8fafc;
            --text-dark: #1e293b;
            --text-light: #f1f5f9;
            --card-bg: rgba(255, 255, 255, 0.1);
            --card-border: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: var(--text-light);
            overflow: hidden;
            min-height: 100vh;
        }

        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
            opacity: 0.3;
        }

        #drawingCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 30;
            cursor: crosshair;
            display: none;
        }

        #laserPointer {
            position: fixed;
            width: 15px;
            height: 15px;
            border: 2px solid #ef4444;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.8);
            z-index: 999;
            pointer-events: none;
            display: none;
        }

        .container {
            position: relative;
            z-index: 10;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--card-border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 20;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .breadcrumb {
            font-size: 0.85rem;
            color: var(--text-light);
            opacity: 0.7;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            order: 3;
            width: 100%;
            padding-top: 0.5rem;
            border-top: 1px solid var(--card-border);
            margin-top: 0.5rem;
        }

        .breadcrumb span {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-section h1 {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .university-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Vazirmatn', sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text-light);
            border: 1px solid var(--card-border);
            padding: 0.5rem 0.8rem;
            font-size: 0.8rem;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-secondary.active {
            background: var(--primary);
            border-color: var(--primary);
        }

        .timer-display {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-weight: 600;
            min-width: 60px;
            text-align: center;
        }

        .slide-container {
            flex: 1;
            overflow: hidden;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            scroll-behavior: smooth;
        }

        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            padding: 3rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.6s ease;
            transform: scale(0.95);
            pointer-events: none;
        }

        .slide.active {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
            z-index: 15;
        }

        .slide.prev {
            opacity: 0;
            transform: scale(0.9);
        }

        .slide-content {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 3rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            animation: slideIn 0.6s ease;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .enhanced-slide {
             background: var(--card-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 3rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            animation: slideIn 0.6s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        .slide-content::-webkit-scrollbar {
            width: 8px;
        }

        .slide-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .slide-content::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }

        .speaker-notes {
            position: absolute;
            bottom: 0;
            right: 0;
            left: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-top: 2px solid var(--primary);
            padding: 1.5rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            z-index: 25;
            font-size: 0.9rem;
        }

        .speaker-notes.active {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .speaker-notes::-webkit-scrollbar {
            width: 6px;
        }

        .speaker-notes::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .speaker-notes::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        .speaker-notes-title {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .notes-content {
            color: var(--text-light);
            opacity: 0.9;
            line-height: 1.6;
        }

        .notes-timing {
            font-size: 0.8rem;
            color: var(--warning);
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .notes-tips {
            font-size: 0.8rem;
            color: var(--success);
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-title {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            min-height: 80vh;
        }

        .slide-title h1 {
            font-size: 3.5rem;
            margin: 2rem 0;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .slide-title h2 {
            font-size: 1.8rem;
            color: var(--text-light);
            margin: 1rem 0;
            font-weight: 500;
        }

        .presenter-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-top: 3rem;
            width: 100%;
        }

        .info-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .info-card .label {
            font-size: 0.9rem;
            color: var(--text-light);
            opacity: 0.7;
            margin-bottom: 0.5rem;
        }

        .info-card .value {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-light);
        }

        .slide-content h2 {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .slide-content h3 {
            font-size: 1.5rem;
            margin: 1.5rem 0 1rem 0;
            color: var(--text-light);
        }

        .slide-content p {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1rem;
            color: rgba(241, 245, 249, 0.9);
        }

        .slide-content ul, .slide-content ol {
            margin: 1.5rem 0;
            padding-right: 2rem;
        }

        .slide-content li {
            margin: 0.8rem 0;
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .enhanced-list li {
             margin-bottom: 0.8rem;
        }

        .formula-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--primary);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.05rem;
            overflow-x: auto;
        }

        .formula-box code {
            color: #60a5fa;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 1.5rem 0;
        }

        .grid-2 > div {
            transition: all 0.3s ease;
        }

        .grid-2 > div:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.2);
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .grid-card {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--card-border);
            padding: 1.5rem;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .grid-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.2);
        }

        .grid-card h3 {
            margin-top: 0;
            color: var(--primary);
        }

        .chart-container {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
            background: rgba(255, 255, 255, 0.03);
            padding: 2rem;
            border-radius: 12px;
            border: 1px solid var(--card-border);
        }

        footer {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--card-border);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 20;
            font-size: 0.95rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .slide-counter {
            font-weight: 600;
            color: var(--primary);
        }

        .progress-bar {
            width: 300px;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            cursor: pointer;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 0.3s ease;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 0.5rem 1rem;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-light);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--primary);
        }

        .code-block, .code-snippet {
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid var(--card-border);
            padding: 1.5rem;
            border-radius: 8px;
            overflow-x: auto;
            margin: 1.5rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .code-block code, .code-snippet span {
            color: #f1f5f9;
        }
        
        .code-snippet .comment { color: #6b7280; }
        .code-snippet .keyword { color: #c084fc; }
        .code-snippet .string { color: #86efac; }

        .shortcut-hint {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--primary);
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.8rem;
            color: var(--text-light);
            z-index: 100;
            max-width: 250px;
        }

        .shortcut-hint strong {
            color: var(--primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
            margin: 1.5rem 0;
        }
        
        .data-table, .mini-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
            margin: 1.5rem 0;
        }

        table thead {
            background: rgba(59, 130, 246, 0.2);
            border-bottom: 2px solid var(--primary);
        }

        table tbody tr {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        table td, table th {
            padding: 1rem;
            text-align: right;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark);
            border: 1px solid var(--card-border);
            border-radius: 16px;
            padding: 2rem;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            color: var(--text-light);
        }

        .modal-header {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--primary);
        }

        .reference-item, .references .reference-item {
            margin: 1.5rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid var(--primary);
            border-radius: 8px;
        }

        .reference-item strong {
            color: var(--text-light);
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-light);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-modal:hover {
            background: var(--danger);
            border-color: var(--danger);
        }
        
        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border-right: 4px solid var(--warning);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .success-box {
             background: rgba(16, 185, 129, 0.1);
             border-right: 4px solid var(--success);
             padding: 1rem;
             border-radius: 8px;
             margin: 1rem 0;
        }
        
        .info-box {
             background: rgba(59, 130, 246, 0.1);
             border-right: 4px solid var(--primary);
             padding: 1rem;
             border-radius: 8px;
             margin: 1rem 0;
        }
        
        .key-insight {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid rgba(59, 130, 246, 0.3);
            margin: 1rem 0;
        }
        
        .highlight-quote {
            font-size: 1.2rem;
            font-style: italic;
            text-align: center;
            margin: 2rem 0;
            color: var(--secondary);
            border-top: 1px solid rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 1rem;
        }
        
        .comparison-section {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }
        .comparison-box {
            flex: 1;
            background: rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 8px;
        }

        .history-tab-content {
            animation: fadeInHistory 0.4s ease;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        .overview-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--card-border);
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-size: 0.9rem;
        }
        .overview-item:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-3px);
        }
        .overview-item.active {
            border-color: var(--success);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
            background: rgba(16, 185, 129, 0.1);
        }

        .badge-2026 {
            background: linear-gradient(45deg, #ff00cc, #3333ff);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 0 15px rgba(255, 0, 204, 0.5);
            animation: pulse 2s infinite;
            display: inline-block;
            margin-top: 1rem;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 204, 0.7); transform: scale(1); }
            70% { box-shadow: 0 0 0 10px rgba(255, 0, 204, 0); transform: scale(1.05); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 204, 0); transform: scale(1); }
        }

        .poll-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            margin-top: 2rem;
        }
        .poll-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            background: rgba(255,255,255,0.05);
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }
        .poll-option:hover, .poll-option.selected {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid var(--primary);
        }
        .poll-icon {
            font-size: 1.5rem;
        }

        @keyframes fadeInHistory {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        #historyTabBtn:hover,
        #peopleTabBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        @media (max-width: 768px) {
            .slide-content {
                padding: 2rem;
            }

            .slide-title h1 {
                font-size: 2rem;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .grid-3 {
                grid-template-columns: 1fr;
            }

            .presenter-info {
                grid-template-columns: 1fr;
            }

            header {
                flex-direction: column;
                align-items: flex-start;
            }

            .breadcrumb {
                order: unset;
                width: auto;
                margin: 0;
                padding: 0;
                border: none;
            }

            .controls {
                width: 100%;
                justify-content: flex-start;
            }
            
            .comparison-section {
                flex-direction: column;
            }
        }

        @media print {
            body {
                background: white !important;
                color: black !important;
            }

            .slide {
                page-break-after: always;
                opacity: 1 !important;
                position: relative !important;
            }

            header, footer, .controls, .speaker-notes, #particleCanvas, #drawingCanvas, #laserPointer {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <canvas id="particleCanvas"></canvas>
    <canvas id="drawingCanvas"></canvas>
    <div id="laserPointer"></div>
    
    <!-- References Modal -->
    <div id="referencesModal" class="modal">
        <div style="position: relative; width: 100%;">
            <button class="close-modal" onclick="closeReferences()">&times;</button>
            <div class="modal-content">
                <div class="modal-header"><i class="fas fa-book"></i> منابع و مراجع</div>
                
                <div class="reference-item">
                    <strong>کتاب‌های اصلی:</strong>
                    <p>Koenker, R. (2005). Quantile Regression. Cambridge University Press.</p>
                </div>

                <div class="reference-item">
                    <strong>مقالات علمی:</strong>
                    <p>Koenker, R., & Bassett, G. (1978). Regression Quantiles. Econometrica, 46, 33-50.</p>
                </div>

                <div class="reference-item">
                    <strong>بسته‌های نرم‌افزاری:</strong>
                    <p>quantreg (R), statsmodels (Python), QuantileRegression.jl (Julia)</p>
                </div>

                <div class="reference-item">
                    <strong>منابع آنلاین:</strong>
                    <p>https://www.r-project.org/conferences/useR-2007/papers/koenker.pdf</p>
                </div>

                <div class="reference-item">
                    <strong>دانشگاه فردوسی مشهد:</strong>
                    <p>دانشکده علوم ریاضی • گروه آمار • 1404</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Overview Modal -->
    <div id="overviewModal" class="modal">
        <div style="position: relative; width: 100%;">
            <button class="close-modal" onclick="toggleOverview()">&times;</button>
            <div class="modal-content">
                <div class="modal-header"><i class="fas fa-th-large"></i> فهرست اسلایدها</div>
                <div id="overviewGrid" class="overview-grid"></div>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <div class="logo-section">
                <!-- Logo REMOVED from header as requested -->
                <h1>رگرسیون کوانتایل</h1>
            </div>
            <div class="university-badge">
                <i class="fas fa-building"></i>
                <span>دانشگاه فردوسی مشهد</span>
            </div>
            <div class="controls">
                <div class="timer-display" id="timerDisplay">00:00</div>
                <button class="btn btn-secondary" onclick="toggleOverview()" title="فهرست (O)">
                    <i class="fas fa-th-large"></i> فهرست
                </button>
                <button class="btn btn-secondary" onclick="toggleTimer()" title="تایمر (T)">
                    <i class="fas fa-hourglass-start"></i> تایمر
                </button>
                <button class="btn btn-secondary" id="laserBtn" onclick="toggleLaser()" title="لیزر (L)">
                    <i class="fas fa-dot-circle"></i> لیزر
                </button>
                <button class="btn btn-secondary" id="penBtn" onclick="togglePen()" title="قلم (P)">
                    <i class="fas fa-pen"></i> قلم
                </button>
                <button class="btn btn-secondary" id="eraserBtn" onclick="toggleEraser()" title="پاک‌کن (E)">
                    <i class="fas fa-eraser"></i> پاک‌کن
                </button>
                <button class="btn btn-secondary" onclick="toggleSpeakerNotes()" title="یادداشت‌ها (N)">
                    <i class="fas fa-sticky-note"></i> یادداشت
                </button>
                <button class="btn btn-secondary" onclick="openReferences()" title="منابع (R)">
                    <i class="fas fa-book"></i> منابع
                </button>
                <button class="btn btn-secondary" onclick="toggleFullscreen()" title="تمام صفحه (F)">
                    <i class="fas fa-expand"></i>
                </button>
            </div>
            <div class="breadcrumb">
                <span><i class="fas fa-home"></i> <span id="breadcrumbPath">صفحه اول</span></span>
            </div>
        </header>

        <div class="slide-container" id="slideContainer"></div>

        <div class="speaker-notes" id="speakerNotes">
            <div class="speaker-notes-title">
                <i class="fas fa-microphone"></i> یادداشت ارائه‌دهنده
            </div>
            <div class="notes-content" id="notesContent"></div>
            <div class="notes-timing" id="notesTiming"></div>
            <div class="notes-tips" id="notesTips"></div>
        </div>

        <footer>
            <div>
                <span class="slide-counter"><span id="currentSlide">1</span> / <span id="totalSlides">35</span></span>
            </div>
            <div class="progress-bar" onclick="progressBarClick(event)">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="previousSlide()">
                    <i class="fas fa-chevron-right"></i> قبلی
                </button>
                <button class="nav-btn" onclick="nextSlide()">
                    بعدی <i class="fas fa-chevron-left"></i>
                </button>
            </div>
        </footer>

        <div class="shortcut-hint">
            <strong>میانبرها:</strong><br>
            ← → / فاصله: جابجایی<br>
            O: فهرست | N: یادداشت<br>
            L: لیزر | P: قلم | E: پاک‌کن<br>
            R: منابع | F: تمام صفحه
        </div>
    </div>

    <script>
        // ==================== SLIDES DATA WITH SPEAKER NOTES ====================
        const slidesData = [
            {
                id: 1,
                title: "رگرسیون کوانتایل",
                type: "title",
                timing: 2,
                content: `
                    <div class="slide-title">
                        <!-- LOGO MOVED HERE as requested -->
                        <img src="https://upload.wikimedia.org/wikipedia/fa/9/90/FUM_Logo.png" style="width: 120px; margin-bottom: 1rem; filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));" alt="FUM Logo">
                        <div class="badge-2026">✨ ارائه ۱۴۰۴ ✨</div>
                        <i class="fas fa-chart-line" style="font-size: 4rem; color: #3b82f6; margin: 1.5rem 0;"></i>
                        <h1>رگرسیون کوانتایل</h1>
                        <h2>Quantile Regression</h2>
                        <p style="font-size: 1.2rem; margin: 2rem 0; opacity: 0.8;">
                            روشی توانمند برای تحلیل توزیع شرطی متغیرهای پاسخ
                        </p>
                        <div class="presenter-info">
                            <div class="info-card">
                                <div class="label">سازنده</div>
                                <div class="value">امیرعلی سطوتی</div>
                            </div>
                            <div class="info-card">
                                <div class="label">ارائه‌دهنده</div>
                                <div class="value">نیلوفر سادات شکوهی</div>
                            </div>
                            <div class="info-card">
                                <div class="label">استاد درس</div>
                                <div class="value">مهدی عمادی</div>
                            </div>
                        </div>
                        <p style="font-size: 0.95rem; margin-top: 3rem; opacity: 0.6;">
                            کارشناسی آمار • دانشگاه فردوسی مشهد • دانشکده علوم ریاضی • ۱۴۰۴
                        </p>
                    </div>
                `,
                notes: {
                    content: "سلام و خوش‌آمدگویی به مخاطبین. این ارائه درباره رگرسیون کوانتایل است، یک روش آماری قدرتمند.",
                    timing: "2 دقیقه",
                    tips: "لبخند بزنید و تماس چشمی برقرار کنید."
                }
            },

            {
                id: 2,
                title: "مرور مطالب",
                type: "content",
                timing: 2,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-book" style="margin-left: 1rem;"></i>مرور مطالب ارائه</h2>
                        <div class="grid-2">
                            <div class="grid-card">
                                <h3><i class="fas fa-graduation-cap" style="color: #3b82f6; margin-left: 0.5rem;"></i>مبانی نظری</h3>
                                <ul>
                                    <li>تعریف و مفاهیم اساسی</li>
                                    <li>مقایسه با رگرسیون کلاسیک</li>
                                    <li>تابع خسارت و بهینه‌سازی</li>
                                    <li>Regularization و تنظیم مدل</li>
                                </ul>
                            </div>
                            <div class="grid-card">
                                <h3><i class="fas fa-cogs" style="color: #8b5cf6; margin-left: 0.5rem;"></i>روش‌های عملی</h3>
                                <ul>
                                    <li>رویکردهای پارامتری</li>
                                    <li>روش‌های ناپارامتری</li>
                                    <li>Splines و هموارسازی</li>
                                    <li>Kernel Methods</li>
                                </ul>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="grid-card">
                                <h3><i class="fas fa-flask" style="color: #10b981; margin-left: 0.5rem;"></i>نمونه‌های عملی</h3>
                                <ul>
                                    <li>داده‌های شبیه‌سازی شده</li>
                                    <li>داده‌های واقعی (Engel)</li>
                                    <li>تصویرسازی نتایج</li>
                                    <li>مقایسه با OLS</li>
                                </ul>
                            </div>
                            <div class="grid-card">
                                <h3><i class="fas fa-code" style="color: #ec4899; margin-left: 0.5rem;"></i>مهندسی نرم‌افزار</h3>
                                <ul>
                                    <li>معماری ماژولار</li>
                                    <li>الگوهای طراحی</li>
                                    <li>بهینه‌سازی کارایی</li>
                                    <li>کیفیت و تست کد</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "این صفحه یک نقشه راه از ارائه است. چهار بخش اصلی را به ترتیب معرفی کنید.",
                    timing: "2 دقیقه",
                    tips: "آرام صحبت کنید و به هر بخش اشاره کنید."
                }
            },
            {
                id: 3,
                title: "مقدمه‌ای بر رگرسیون",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-chart-scatter" style="margin-left: 1rem;"></i>رگرسیون چیست؟</h2>
                        <p>
                            <strong>رگرسیون</strong> یکی از پرکاربردترین روش‌های آماری است که به ما کمک می‌کند تا 
                            <span style="color: #3b82f6; font-weight: 600;">رابطه میان متغیرها</span> را بررسی کنیم.
                        </p>
                        <div class="formula-box">
                            <strong>فرم کلی:</strong> Y = f(X₁, X₂, ..., Xₚ) + ε
                        </div>
                        <h3>انواع رگرسیون:</h3>
                        <div class="grid-3">
                            <div class="grid-card">
                                <h3 style="color: #3b82f6; margin-top: 0;">رگرسیون خطی</h3>
                                <p>روش کلاسیک OLS برای میانگین شرطی</p>
                                <div class="chart-container" style="min-height: 150px;">
                                    <svg width="200" height="150" viewBox="0 0 200 150">
                                        <line x1="20" y1="130" x2="180" y2="130" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                        <line x1="20" y1="130" x2="20" y2="20" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                        <polyline points="30,110 50,90 70,70 90,60 110,50 130,40 150,30 170,20" fill="none" stroke="#3b82f6" stroke-width="2"/>
                                        <circle cx="40" cy="100" r="2" fill="#10b981"/>
                                        <circle cx="80" cy="65" r="2" fill="#10b981"/>
                                        <circle cx="150" cy="35" r="2" fill="#10b981"/>
                                    </svg>
                                </div>
                                <p style="font-size: 0.9rem; opacity: 0.7;">E(Y|X)</p>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #8b5cf6; margin-top: 0;">رگرسیون کوانتایل</h3>
                                <p>تحلیل توزیع شرطی متغیر</p>
                                <div class="chart-container" style="min-height: 150px;">
                                    <svg width="200" height="150" viewBox="0 0 200 150">
                                        <line x1="20" y1="130" x2="180" y2="130" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                        <line x1="20" y1="130" x2="20" y2="20" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                        <polyline points="30,120 50,100 70,80 90,70 110,60 130,50 150,35 170,25" fill="none" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="3,3"/>
                                        <polyline points="30,110 50,90 70,70 90,60 110,50 130,40 150,30 170,20" fill="none" stroke="#10b981" stroke-width="2"/>
                                        <polyline points="30,100 50,80 70,60 90,50 110,40 130,30 150,20 170,15" fill="none" stroke="#3b82f6" stroke-width="2" stroke-dasharray="3,3"/>
                                    </svg>
                                </div>
                                <p style="font-size: 0.9rem; opacity: 0.7;">Q<sub>τ</sub>(Y|X)</p>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #ec4899; margin-top: 0;">رگرسیون قوی</h3>
                                <p>کاهش اثر نقاط دورافتاده</p>
                                <div class="chart-container" style="min-height: 150px;">
                                    <svg width="200" height="150" viewBox="0 0 200 150">
                                        <line x1="20" y1="130" x2="180" y2="130" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                        <line x1="20" y1="130" x2="20" y2="20" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                        <polyline points="30,110 50,90 70,75 90,65 110,55 130,42 150,32 170,22" fill="none" stroke="#ec4899" stroke-width="2"/>
                                        <circle cx="160" cy="45" r="3" fill="#ef4444" opacity="0.5"/>
                                    </svg>
                                </div>
                                <p style="font-size: 0.9rem; opacity: 0.7;">Robust Methods</p>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "رگرسیون روابط میان متغیرها را بررسی می‌کند. سه نوع اصلی: خطی (میانگین)، کوانتایل (توزیع)، و قوی (ضد outlier).",
                    timing: "3 دقیقه",
                    tips: "نمودارهای کنار را نشان دهید و تفاوت‌ها را توضیح دهید."
                }
            },

            {
                id: 4,
                title: "رگرسیون خطی کلاسیک (OLS)",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-line-chart" style="margin-left: 1rem;"></i>روش حداقل مربعات (OLS)</h2>
                        <div class="formula-box">
                            <strong>مدل:</strong> Y<sub>i</sub> = β₀ + β₁X<sub>i</sub> + ε<sub>i</sub><br>
                            <strong>تابع هدف:</strong> min Σ(Y<sub>i</sub> - β₀ - β₁X<sub>i</sub>)²
                        </div>
                        <h3>ویژگی‌های OLS:</h3>
                        <ul>
                            <li><strong>میانگین شرطی:</strong> OLS میانگین توزیع Y|X را برآورد می‌کند</li>
                            <li><strong>حساسیت به نقاط دورافتاده:</strong> مربع خطا نقاط دورافتاده را تشدید می‌کند</li>
                            <li><strong>فرضیات قوی:</strong> نرمال بودن خطاها و واریانس ثابت</li>
                            <li><strong>تفسیر آسان:</strong> ضرایب رابطه خطی میانگین را نشان می‌دهند</li>
                        </ul>
                        <div class="chart-container">
                            <svg width="400" height="250" viewBox="0 0 400 250" style="background: rgba(255,255,255,0.03); border-radius: 8px;">
                                <defs>
                                    <linearGradient id="gradOLS" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.8" />
                                        <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:0" />
                                    </linearGradient>
                                </defs>
                                <g transform="translate(40,20)">
                                    <line x1="0" y1="180" x2="320" y2="180" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                    <line x1="0" y1="180" x2="0" y2="20" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                    <polyline points="0,150 40,130 80,100 120,90 160,70 200,60 240,50 280,40 320,30" fill="url(#gradOLS)" stroke="#3b82f6" stroke-width="3"/>
                                    <circle cx="20" cy="145" r="4" fill="#10b981"/>
                                    <circle cx="50" cy="125" r="4" fill="#10b981"/>
                                    <circle cx="100" cy="95" r="4" fill="#10b981"/>
                                    <circle cx="150" cy="65" r="4" fill="#10b981"/>
                                    <circle cx="200" cy="55" r="4" fill="#10b981"/>
                                    <circle cx="250" cy="45" r="4" fill="#10b981"/>
                                </g>
                                <text x="200" y="230" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="12">متغیر مستقل (X)</text>
                            </svg>
                        </div>
                    </div>
                `,
                notes: {
                    content: "OLS حداقل مربعات است. تنها میانگین را برآورد می‌کند. حساسیت به نقاط دورافتاده مشکل اصلی است.",
                    timing: "3 دقیقه",
                    tips: "نمودار را توضیح دهید: خط و نقاط داده."
                }
            },

            {
                id: 5,
                title: "محدودیت‌های OLS",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-exclamation-triangle" style="margin-left: 1rem; color: #f59e0b;"></i>محدودیت‌های رگرسیون OLS</h2>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #ef4444;">
                                <h3 style="color: #ef4444;">حساسیت به Outliers</h3>
                                <p>
                                    نقاط دورافتاده بر تخمین ضرایب تأثیر شدیدی دارند زیرا هر نقطه با مربع انحراف خود وارد می‌شود.
                                </p>
                                <div style="background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                                    <p style="font-size: 0.9rem; margin-bottom: 0.5rem;"><strong>مثال:</strong></p>
                                    <p style="font-size: 0.85rem;">اگر یک نقطه انحراف بزرگی داشته باشد، تأثیرش به صورت درجه دوم ظاهر می‌شود</p>
                                </div>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #f59e0b;">
                                <h3 style="color: #f59e0b;">فرضیات محدود</h3>
                                <ul style="font-size: 0.95rem;">
                                    <li>واریانس باید ثابت باشد (Homoscedasticity)</li>
                                    <li>خطاها باید نرمال توزیع شوند</li>
                                    <li>خطاها باید مستقل باشند</li>
                                </ul>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #8b5cf6;">
                                <h3 style="color: #8b5cf6;">فقط میانگین</h3>
                                <p>
                                    OLS فقط میانگین توزیع شرطی را برآورد می‌کند. اطلاعاتی در مورد کوانتایل‌های دیگر نمی‌دهد.
                                </p>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #ec4899;">
                                <h3 style="color: #ec4899;">متغیر پاسخ محدود</h3>
                                <p>
                                    برای متغیرهای پاسخ محدود (0-1) یا شمارشی، OLS مناسب نیست.
                                </p>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "OLS چهار مشکل عمده: حساسیت Outlier، فرضیات محدود، فقط میانگین، و نامناسب برای پاسخ محدود.",
                    timing: "3 دقیقه",
                    tips: "هر کدام را با مثال توضیح دهید."
                }
            },

            {
                id: 6,
                title: "تعریف کوانتایل",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-arrows-alt-h" style="margin-left: 1rem;"></i>کوانتایل چیست؟</h2>
                        <p style="font-size: 1.1rem; margin-bottom: 1.5rem;">
                            <strong>کوانتایل</strong> یک مقدار از توزیع احتمالی است که مشخص می‌کند چند درصد داده‌ها زیر آن مقدار قرار دارند.
                        </p>
                        <div class="formula-box">
                            <strong>تعریف ریاضی:</strong><br>
                            Q<sub>τ</sub> = inf{y : F(y) ≥ τ}<br><br>
                            که در آن:<br>
                            τ ∈ (0,1) سطح کوانتایل است<br>
                            F(y) تابع توزیع تجمعی است
                        </div>
                        <h3>کوانتایل‌های معروف:</h3>
                        <div class="grid-3">
                            <div class="grid-card">
                                <p style="text-align: center; font-size: 2rem; color: #ef4444; font-weight: 700; margin: 0;">Q₁</p>
                                <p style="text-align: center;">۲۵ امین صدک</p>
                                <p style="text-align: center; font-size: 0.85rem; opacity: 0.7;">ربع اول</p>
                                <div class="chart-container" style="min-height: 100px;">
                                    <svg width="120" height="100" viewBox="0 0 120 100">
                                        <line x1="10" y1="80" x2="110" y2="80" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                        <rect x="10" y="60" width="30" height="20" fill="#ef4444" opacity="0.5"/>
                                        <rect x="40" y="20" width="70" height="60" fill="rgba(255,255,255,0.1)"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="grid-card">
                                <p style="text-align: center; font-size: 2rem; color: #10b981; font-weight: 700; margin: 0;">Q₂</p>
                                <p style="text-align: center;">۵۰ امین صدک</p>
                                <p style="text-align: center; font-size: 0.85rem; opacity: 0.7;">میانه</p>
                                <div class="chart-container" style="min-height: 100px;">
                                    <svg width="120" height="100" viewBox="0 0 120 100">
                                        <line x1="10" y1="80" x2="110" y2="80" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                        <rect x="10" y="20" width="60" height="60" fill="#10b981" opacity="0.5"/>
                                        <rect x="70" y="20" width="40" height="60" fill="rgba(255,255,255,0.1)"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="grid-card">
                                <p style="text-align: center; font-size: 2rem; color: #3b82f6; font-weight: 700; margin: 0;">Q₃</p>
                                <p style="text-align: center;">۷۵ امین صدک</p>
                                <p style="text-align: center; font-size: 0.85rem; opacity: 0.7;">ربع سوم</p>
                                <div class="chart-container" style="min-height: 100px;">
                                    <svg width="120" height="100" viewBox="0 0 120 100">
                                        <line x1="10" y1="80" x2="110" y2="80" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                        <rect x="10" y="20" width="90" height="60" fill="#3b82f6" opacity="0.5"/>
                                        <rect x="100" y="20" width="10" height="60" fill="rgba(255,255,255,0.1)"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "کوانتایل مقدار است که درصد خاصی داده‌ها زیر آن است. Q₁ (۲۵%)، Q₂ (۵۰% = میانه)، Q₃ (۷۵%).",
                    timing: "3 دقیقه",
                    tips: "نمودارهای توزیع را نشان دهید."
                }
            },

            {
                id: 7,
                title: "رگرسیون کوانتایل",
                type: "content",
                timing: 4,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-project-diagram" style="margin-left: 1rem;"></i>رگرسیون کوانتایل چیست؟</h2>
                        <p style="font-size: 1.05rem;">
                            <strong>رگرسیون کوانتایل</strong> توزیع شرطی کامل متغیر پاسخ را تحلیل می‌کند، نه تنها میانگین شرطی آن.
                        </p>
                        <div class="formula-box">
                            <strong>مدل رگرسیون کوانتایل:</strong><br>
                            Q<sub>τ</sub>(Y<sub>i</sub> | X<sub>i</sub>) = β₀(τ) + β₁(τ)X₁<sub>i</sub> + ... + β<sub>p</sub>(τ)X<sub>p</sub><sub>i</sub><br><br>
                            <strong>تابع خسارت (Check Loss):</strong><br>
                            min Σ ρ<sub>τ</sub>(Y<sub>i</sub> - X<sub>i</sub>β(τ))<br>
                            که ρ<sub>τ</sub>(u) = u(τ - I(u&lt;0))
                        </div>
                        <h3>مزایای رگرسیون کوانتایل:</h3>
                        <ul>
                            <li><strong>توزیع کامل:</strong> اطلاعات در مورد کل توزیع شرطی Y|X</li>
                            <li><strong>قوی:</strong> نقاط دورافتاده تأثیر کمتری دارند</li>
                            <li><strong>انعطاف‌پذیر:</strong> ضرایب مختلف برای کوانتایل‌های مختلف</li>
                            <li><strong>فرض‌های ضعیف‌تر:</strong> نیاز به فرضیات کمتری نسبت به OLS</li>
                        </ul>
                    </div>
                `,
                notes: {
                    content: "رگرسیون کوانتایل توزیع کامل را برآورد می‌کند. قوی، انعطاف‌پذیر، و فرضیات کمتری دارد.",
                    timing: "4 دقیقه",
                    tips: "فرمول را خط به خط توضیح دهید."
                }
            },

            {
                id: 8,
                title: "تابع خسارت Check Loss",
                type: "content",
                timing: 4,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-function" style="margin-left: 1rem;"></i>تابع خسارت Check Loss</h2>
                        <p style="font-size: 1.05rem;">
                            تابع Check Loss برای بهینه‌سازی رگرسیون کوانتایل استفاده می‌شود:
                        </p>
                        <div class="formula-box">
                            <strong>تعریف:</strong><br>
                            ρ<sub>τ</sub>(u) = {<br>
                            &nbsp;&nbsp;τ·u &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; اگر u ≥ 0<br>
                            &nbsp;&nbsp;(τ-1)·u &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; اگر u &lt; 0<br>
                            }<br><br>
                            یا: ρ<sub>τ</sub>(u) = u(τ - I(u&lt;0))
                        </div>
                        <div class="chart-container">
                            <svg width="500" height="280" viewBox="0 0 500 280" style="background: rgba(255,255,255,0.03); border-radius: 8px;">
                                <defs>
                                    <linearGradient id="gradCheck" x1="0%" y1="0%" x2="100%" y2="0%">
                                        <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
                                        <stop offset="50%" style="stop-color:#f59e0b;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#10b981;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <g transform="translate(50,30)">
                                    <line x1="0" y1="180" x2="400" y2="180" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                    <line x1="200" y1="200" x2="200" y2="0" stroke="rgba(255,255,255,0.3)" stroke-width="2"/>
                                    <polyline points="0,250 50,190 100,130 150,70 200,20 250,80 300,140 350,200 400,260" fill="none" stroke="url(#gradCheck)" stroke-width="3"/>
                                    <circle cx="200" cy="20" r="5" fill="#3b82f6"/>
                                    <text x="200" y="10" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="12">Q(τ)</text>
                                </g>
                                <text x="250" y="270" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="12">خطا (u)</text>
                            </svg>
                        </div>
                        <h3>ویژگی‌های Check Loss:</h3>
                        <ul>
                            <li>تقارن نداشتن: خطاهای مثبت و منفی وزن متفاوتی دارند</li>
                            <li>توازن: τ و (۱-τ) را متوازن می‌کند</li>
                            <li>Robust: به نقاط دورافتاده حساس نیست</li>
                        </ul>
                    </div>
                `,
                notes: {
                    content: "Check Loss تابع خسارت نامتقارن است. خطاهای مثبت با وزن τ و منفی با وزن (۱-τ).",
                    timing: "4 دقیقه",
                    tips: "نمودار V شکل را توضیح دهید."
                }
            },

            {
                id: 9,
                title: "تاریخچه و پیشگامان",
                type: "interactive",
                timing: 5,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-history" style="margin-left: 1rem;"></i>تاریخچه رگرسیون کوانتایل و پیشگامان</h2>
                        
                        <div style="display: flex; gap: 1rem; margin-bottom: 2rem; border-bottom: 2px solid rgba(59, 130, 246, 0.3); padding-bottom: 0.5rem;">
                            <button id="historyTabBtn" onclick="switchHistoryTab('history')" style="padding: 0.8rem 1.5rem; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border: none; border-radius: 8px 8px 0 0; cursor: pointer; font-family: 'Vazirmatn', sans-serif; font-size: 1rem; font-weight: 600; transition: all 0.3s;">
                                <i class="fas fa-book-open"></i> تاریخچه
                            </button>
                            <button id="peopleTabBtn" onclick="switchHistoryTab('people')" style="padding: 0.8rem 1.5rem; background: rgba(255,255,255,0.05); color: var(--text-light); border: 1px solid var(--card-border); border-radius: 8px 8px 0 0; cursor: pointer; font-family: 'Vazirmatn', sans-serif; font-size: 1rem; font-weight: 600; transition: all 0.3s;">
                                <i class="fas fa-users"></i> پیشگامان
                            </button>
                        </div>

                        <div id="historyContent" style="display: block;">
                            <h3 style="color: var(--primary); margin-bottom: 1.5rem;"><i class="fas fa-timeline"></i> خط زمانی رگرسیون کوانتایل</h3>
                            <div style="position: relative; padding-right: 2rem; border-right: 3px solid var(--primary);">
                                
                                <div style="margin-bottom: 2rem; position: relative;">
                                    <div style="position: absolute; right: -2.3rem; width: 1.5rem; height: 1.5rem; background: var(--primary); border-radius: 50%; border: 3px solid var(--dark);"></div>
                                    <div style="background: rgba(59, 130, 246, 0.1); padding: 1.5rem; border-radius: 8px; border-right: 4px solid var(--primary);">
                                        <h4 style="color: var(--primary); margin-bottom: 0.5rem;">۱۹۷۸ - تولد رگرسیون کوانتایل</h4>
                                        <p>Roger Koenker و Gilbert Bassett مقاله تاریخی "Regression Quantiles" را در Econometrica منتشر کردند.</p>
                                    </div>
                                </div>

                                <div style="margin-bottom: 2rem; position: relative;">
                                    <div style="position: absolute; right: -2.3rem; width: 1.5rem; height: 1.5rem; background: var(--secondary); border-radius: 50%; border: 3px solid var(--dark);"></div>
                                    <div style="background: rgba(139, 92, 246, 0.1); padding: 1.5rem; border-radius: 8px; border-right: 4px solid var(--secondary);">
                                        <h4 style="color: var(--secondary); margin-bottom: 0.5rem;">دهه ۱۹۸۰ - گسترش ناپارامتری</h4>
                                        <p>توسعه روش‌های kernel-based و spline-based برای انعطاف‌پذیری بیشتر.</p>
                                    </div>
                                </div>

                                <div style="margin-bottom: 2rem; position: relative;">
                                    <div style="position: absolute; right: -2.3rem; width: 1.5rem; height: 1.5rem; background: var(--accent); border-radius: 50%; border: 3px solid var(--dark);"></div>
                                    <div style="background: rgba(236, 72, 153, 0.1); padding: 1.5rem; border-radius: 8px; border-right: 4px solid var(--accent);">
                                        <h4 style="color: var(--accent); margin-bottom: 0.5rem;">دهه ۱۹۹۰ - پیشرفت‌های محاسباتی</h4>
                                        <p>الگوریتم‌های کارآمدتر و نظریه آماری قوی‌تر برای رگرسیون کوانتایل ناپارامتریک.</p>
                                    </div>
                                </div>

                                <div style="position: relative;">
                                    <div style="position: absolute; right: -2.3rem; width: 1.5rem; height: 1.5rem; background: var(--success); border-radius: 50%; border: 3px solid var(--dark);"></div>
                                    <div style="background: rgba(16, 185, 129, 0.1); padding: 1.5rem; border-radius: 8px; border-right: 4px solid var(--success);">
                                        <h4 style="color: var(--success); margin-bottom: 0.5rem;">۲۰۰۰ تاکنون - عصر مدرن</h4>
                                        <p>کاربردهای گسترده در یادگیری ماشین، اقتصاد، پزشکی. توسعه Deep Quantile Regression.</p>
                                    </div>
                                </div>

                            </div>

                            <div style="margin-top: 2rem; background: rgba(59, 130, 246, 0.1); border-right: 4px solid var(--primary); padding: 1.5rem; border-radius: 8px;">
                                <h4 style="color: var(--primary); margin-bottom: 1rem;"><i class="fas fa-link"></i> منابع بیشتر</h4>
                                <ul style="list-style: none; padding: 0;">
                                    <li style="margin: 0.5rem 0;">
                                        <a href="https://en.wikipedia.org/wiki/Quantile_regression" target="_blank" style="color: #60a5fa; text-decoration: none;">
                                            <i class="fas fa-external-link-alt"></i> ویکی‌پدیا: Quantile Regression
                                        </a>
                                    </li>
                                    <li style="margin: 0.5rem 0;">
                                        <a href="https://www.jstor.org/stable/1913643" target="_blank" style="color: #60a5fa; text-decoration: none;">
                                            <i class="fas fa-file-pdf"></i> مقاله اصلی Koenker & Bassett (1978)
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div id="peopleContent" style="display: none;">
                            <h3 style="color: var(--primary); margin-bottom: 1.5rem;"><i class="fas fa-user-tie"></i> پیشگامان رگرسیون کوانتایل</h3>
                            
                            <div class="grid-2" style="gap: 2rem;">
                                
                                <div style="background: rgba(59, 130, 246, 0.05); border: 2px solid var(--primary); border-radius: 12px; padding: 1.5rem; display: flex; gap: 1.5rem;">
                                    <div style="flex: 0 0 100px;">
                                        <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: 700; box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);">
                                            RK
                                        </div>
                                    </div>
                                    <div style="flex: 1;">
                                        <h4 style="color: var(--primary); font-size: 1.3rem; margin-bottom: 0.5rem;">Roger Koenker</h4>
                                        <p style="font-size: 0.95rem; opacity: 0.9; line-height: 1.6; margin-bottom: 1rem;">
                                            استاد اقتصادسنجی و آمار در دانشگاه ایلینوی. بنیان‌گذار رگرسیون کوانتایل مدرن با مقاله انقلابی ۱۹۷۸. نویسنده کتاب‌های متعدد در این حوزه.
                                        </p>
                                    </div>
                                </div>

                                <div style="background: rgba(139, 92, 246, 0.05); border: 2px solid var(--secondary); border-radius: 12px; padding: 1.5rem; display: flex; gap: 1.5rem;">
                                    <div style="flex: 0 0 100px;">
                                        <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #8b5cf6, #ec4899); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: 700; box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);">
                                            GB
                                        </div>
                                    </div>
                                    <div style="flex: 1;">
                                        <h4 style="color: var(--secondary); font-size: 1.3rem; margin-bottom: 0.5rem;">Gilbert Bassett Jr.</h4>
                                        <p style="font-size: 0.95rem; opacity: 0.9; line-height: 1.6; margin-bottom: 1rem;">
                                            اقتصاددان و استاد دانشگاه ایلینوی. همکار اصلی Koenker در توسعه رگرسیون کوانتایل. تحقیقات در اقتصادسنجی مالی و روش‌های قوی (Robust).
                                        </p>
                                    </div>
                                </div>

                            </div>

                            <div style="margin-top: 2rem; background: rgba(16, 185, 129, 0.1); border-right: 4px solid var(--success); padding: 1.5rem; border-radius: 8px;">
                                <h4 style="color: var(--success); margin-bottom: 0.5rem;"><i class="fas fa-lightbulb"></i> نکته مهم</h4>
                                <p style="line-height: 1.6;">
                                    رگرسیون کوانتایل به لطف کار پایه‌گذار این دو محقق، امروزه یکی از ابزارهای استاندارد در تحلیل داده‌های پیچیده و ناهمگن است و در علوم مختلف از اقتصاد تا پزشکی کاربرد دارد.
                                </p>
                            </div>
                        </div>

                    </div>
                `,
                notes: {
                    content: "اسلاید تعاملی با دو تب: تاریخچه و پیشگامان. Koenker & Bassett در ۱۹۷۸ این روش را معرفی کردند.",
                    timing: "۵ دقیقه",
                    tips: "حتماً روی لینک‌های ویکی‌پدیا اشاره کنید. تب‌ها را جابجا کنید."
                }
            },

            {
                id: 10,
                title: "روش‌های بهینه‌سازی",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-cogs" style="margin-left: 1rem;"></i>روش‌های بهینه‌سازی در رگرسیون کوانتایل</h2>
                        
                        <p style="font-size: 1.05rem; line-height: 1.9;">
                            رگرسیون کوانتایل را می‌توان به صورت یک مسئله برنامه‌ریزی خطی فرموله کرد که اجازه می‌دهد از الگوریتم‌های قدرتمند بهینه‌سازی استفاده کنیم.
                        </p>

                        <div class="formula-box">
                            <strong>فرم کلی مسئله:</strong><br>
                            min<sub>β</sub> Σ ρ<sub>τ</sub>(Y<sub>i</sub> - X<sub>i</sub>β)<br><br>
                            <strong>تابع زیان (Pinball Loss):</strong><br>
                            ρ<sub>τ</sub>(u) = u(τ - I(u &lt; 0))<br><br>
                            <strong>فرم LP استاندارد:</strong><br>
                            min τ Σ r<sub>i</sub>⁺ + (1-τ) Σ r<sub>i</sub>⁻<br>
                            s.t. Y<sub>i</sub> - X<sub>i</sub>β = r<sub>i</sub>⁺ - r<sub>i</sub>⁻<br>
                            r<sub>i</sub>⁺, r<sub>i</sub>⁻ ≥ 0
                        </div>

                        <h3>الگوریتم‌های حل:</h3>
                        <div class="grid-3">
                            <div class="grid-card">
                                <h3 style="color: #3b82f6; margin-top: 0;">Simplex</h3>
                                <p style="font-size: 0.9rem;">
                                    الگوریتم کلاسیک LP؛ دقیق و مناسب ابعاد کوچک و متوسط.
                                </p>
                                <p style="font-size: 0.8rem; opacity: 0.7;">مزیت: جواب دقیق، پیاده‌سازی بالغ در نرم‌افزارها.</p>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #8b5cf6; margin-top: 0;">Interior Point</h3>
                                <p style="font-size: 0.9rem;">
                                    روش نقاط داخلی؛ برای مسائل بزرگ‌تر سریع‌تر و مقیاس‌پذیرتر از Simplex است.
                                </p>
                                <p style="font-size: 0.8rem; opacity: 0.7;">مزیت: مناسب Big Data و مسائل با متغیرهای زیاد.</p>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #ec4899; margin-top: 0;">Gradient Descent</h3>
                                <p style="font-size: 0.9rem;">
                                    حل تقریبی با به‌روزرسانی تکراری؛ مناسب یادگیری ماشین و داده‌های خیلی بزرگ.
                                </p>
                                <p style="font-size: 0.8rem; opacity: 0.7;">مزیت: ساده، آنلاین، قابل اجرا روی GPU.</p>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "سه روش را از نظر سرعت، دقت و مقیاس‌پذیری مقایسه کنید و روی فرم LP تاکید کنید.",
                    timing: "3 دقیقه",
                    tips: "با یک مثال شهودی برای Pinball Loss شروع کنید."
                }
            },

            {
                id: 11,
                title: "Regularization",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-sliders-h" style="margin-left: 1rem;"></i>Regularization (تنظیم مدل)</h2>
                        <p style="font-size: 1.05rem;">
                            Regularization برای کنترل پیچیدگی مدل و جلوگیری از بیش‌برازش در رگرسیون کوانتایل استفاده می‌شود، مخصوصاً وقتی تعداد متغیرها زیاد است.
                        </p>

                        <div class="grid-3">
                            <div class="grid-card">
                                <h3 style="color:#ec4899;">L1 (LASSO)</h3>
                                <p style="font-size:0.9rem;">
                                    اضافه کردن λ Σ |β<sub>j</sub>| باعث صفر شدن بعضی ضرایب و انتخاب متغیر می‌شود.
                                </p>
                                <p style="font-size:0.8rem;opacity:.7;">خوب برای مدل‌های تنک (Sparse).</p>
                            </div>
                            <div class="grid-card">
                                <h3 style="color:#3b82f6;">L2 (Ridge)</h3>
                                <p style="font-size:0.9rem;">
                                    اضافه کردن λ Σ β<sub>j</sub>² ضرایب را کوچک می‌کند و با هم‌خطی مقابله می‌کند.
                                </p>
                                <p style="font-size:0.8rem;opacity:.7;">خوب برای Multicollinearity.</p>
                            </div>
                            <div class="grid-card">
                                <h3 style="color:#10b981;">Elastic Net</h3>
                                <p style="font-size:0.9rem;">
                                    ترکیبی از L1 و L2؛ تعادل بین انتخاب متغیر و پایداری ضرایب.
                                </p>
                                <p style="font-size:0.8rem;opacity:.7;">در عمل بیشترین استفاده را دارد.</p>
                            </div>
                        </div>

                        <div class="highlight-quote">
                            در رگرسیون کوانتایل با ابعاد بالا، بدون Regularization مدل به‌راحتی بیش‌برازش می‌کند.
                        </div>
                    </div>
                `,
                notes: {
                    content: "L1 → انتخاب متغیر، L2 → پایداری، Elastic Net → ترکیب هر دو.",
                    timing: "3 دقیقه",
                    tips: "یک مثال ساده بزنید که چطور L1 بعضی ضرایب را صفر می‌کند."
                }
            },

            {
                id: 12,
                title: "انتخاب Bandwidth",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-ruler-horizontal" style="margin-left: 1rem;"></i>انتخاب Bandwidth</h2>
                        <p style="font-size:1.05rem;">
                            در رگرسیون کوانتایل ناپارامتری (مثلاً با Kernel)، پارامتر Bandwidth میزان هموارسازی را کنترل می‌کند.
                        </p>
                        <div class="info-box">
                            <strong>موازنه اصلی:</strong>
                            <ul class="enhanced-list">
                                <li>Bandwidth خیلی کوچک → مدل پرنویز، Overfitting.</li>
                                <li>Bandwidth خیلی بزرگ → مدل بیش از حد صاف، Underfitting.</li>
                            </ul>
                        </div>
                        <p style="font-size:0.95rem;">
                            معمولاً از Cross-validation برای انتخاب Bandwidth بهینه استفاده می‌شود تا خطای پیش‌بینی حداقل شود.
                        </p>
                    </div>
                `,
                notes: {
                    content: "توضیح کیفی Underfitting/Overfitting و اشاره به Cross-validation.",
                    timing: "3 دقیقه",
                    tips: "اگر وقت بود یک نمودار شماتیک از bandwidth کوچک/بزرگ نشان دهید."
                }
            },

            {
                id: 13,
                title: "رگرسیون کوانتایل محلی",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-map-marker-alt" style="margin-left: 1rem;"></i>رگرسیون کوانتایل محلی</h2>
                        <p style="font-size:1.05rem;">
                            در رگرسیون کوانتایل محلی (Local QR)، به جای یک رابطه جهانی، برای هر نقطه با وزن‌دهی Kernel یک مدل محلی برازش می‌شود.
                        </p>
                        <p style="font-size:0.95rem;">
                            توابع Kernel رایج شامل Gaussian و Epanechnikov هستند که وزن مشاهدات نزدیک را بیشتر و دورتر را کمتر می‌کنند.
                        </p>
                        <div class="formula-box">
                            <strong>Kernel Gaussian:</strong><br>
                            K(u) = (1/√(2π)) exp(-u²/2)<br><br>
                            <strong>Kernel Epanechnikov:</strong><br>
                            K(u) = (3/4)(1-u²) برای |u| ≤ 1
                        </div>
                    </div>
                `,
                notes: {
                    content: "Local QR + Kernel (Gaussian, Epanechnikov).",
                    timing: "3 دقیقه",
                    tips: "مقایسه کوتاه بین مدل خطی جهانی و مدل محلی قابل‌انعطاف."
                }
            },

            {
                id: 14,
                title: "Splines و هموارسازی",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-bezier-curve" style="margin-left: 1rem;"></i>Splines و هموارسازی</h2>
                        <p style="font-size:1.05rem;">
                            Splines منحنی‌های قطعه‌ای چندجمله‌ای هستند که امکان مدل‌سازی روابط غیرخطی انعطاف‌پذیر را در رگرسیون کوانتایل می‌دهند.
                        </p>
                        <p style="font-size:0.95rem;">
                            در عمل از Regression Splines و Smoothing Splines استفاده می‌شود و تعداد Knots شدت انعطاف‌پذیری را تعیین می‌کند.
                        </p>
                        <div class="comparison-section">
                            <div class="comparison-box">
                                <h4>Regression Splines</h4>
                                <ul>
                                    <li>Knots ثابت و از پیش تعیین شده</li>
                                    <li>کنترل مستقیم روی انعطاف‌پذیری</li>
                                </ul>
                            </div>
                            <div class="comparison-box">
                                <h4>Smoothing Splines</h4>
                                <ul>
                                    <li>تنظیم خودکار با پارامتر λ</li>
                                    <li>موازنه بین fit و smoothness</li>
                                </ul>
                            </div>
                        </div>
                        <div class="warning-box">
                            <strong>نکته:</strong> Knots زیاد → پرنویز، Knots کم → صاف
                        </div>
                    </div>
                `,
                notes: {
                    content: "تفاوت Regression Splines و Smoothing Splines را بگویید.",
                    timing: "3 دقیقه",
                    tips: "بگویید Knots زیاد → پرنویز، Knots کم → صاف."
                }
            },

            {
                id: 15,
                title: "محدودیت عدم تقاطع",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-ban" style="margin-left: 1rem;"></i>محدودیت عدم تقاطع</h2>
                        <p style="font-size:1.05rem;">
                            به طور منطقی، اگر τ₁ &lt; τ₂ باشد، باید برای هر x داشته باشیم Q<sub>τ₁</sub>(x) ≤ Q<sub>τ₂</sub>(x)؛ در غیر این صورت کوانتایل‌ها یکدیگر را قطع کرده‌اند.
                        </p>

                        <div class="warning-box">
                            <strong>مشکل:</strong>
                            <p>برآورد جداگانه برای هر τ ممکن است به منحنی‌های کوانتایل متقاطع (Quantile Crossing) منجر شود.</p>
                        </div>

                        <div class="success-box">
                            <strong>راه‌حل‌های رایج:</strong>
                            <ul class="enhanced-list">
                                <li>استفاده از Rearrangement (مرتب‌سازی مونوتون) روی منحنی‌های کوانتایل برآوردشده.</li>
                                <li>افزودن محدودیت‌های یکنواختی در بهینه‌سازی (Monotonicity Constraints).</li>
                                <li>تصحیح پس از برآورد (Post-hoc Correction).</li>
                            </ul>
                        </div>
                        
                        <div class="formula-box">
                            <strong>شرط منطقی:</strong><br>
                            ∀x: Q<sub>0.25</sub>(x) ≤ Q<sub>0.5</sub>(x) ≤ Q<sub>0.75</sub>(x)
                        </div>
                    </div>
                `,
                notes: {
                    content: "برای τ₁ < τ₂: Q_τ₁ ≤ Q_τ₂. Chernozhukov et al. (2010) را به عنوان رفرنس بگویید.",
                    timing: "3 دقیقه",
                    tips: "با یک نمودار ذهنی از سه کوانتایل که از هم رد می‌شوند شروع کنید."
                }
            },

            {
                id: 16,
                title: "مثال عملی ۱",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-vial" style="margin-left: 1rem;"></i>مثال ۱: داده‌های شبیه‌سازی شده</h2>
                        <p style="font-size:1.05rem;">
                            مدل شبیه‌سازی: Y = 1 + 1.5X + ε که ε از توزیع Laplace (دارای دنباله‌های سنگین) است.
                        </p>
                        <p style="font-size:0.95rem;">
                            در چنین حالتی، رگرسیون OLS شدیداً تحت تأثیر نقاط دورافتاده قرار می‌گیرد، در حالی‌که رگرسیون کوانتایل برای میانه و کوانتایل‌های دیگر پایدارتر است.
                        </p>
                        <div class="info-box">
                            <strong>مشاهدات:</strong>
                            <ul class="enhanced-list">
                                <li>خط OLS توسط outlierها کج می‌شود</li>
                                <li>خط میانه (τ=0.5) مقاوم و دقیق است</li>
                                <li>کوانتایل‌های دنباله (τ=0.1, 0.9) رفتار متفاوتی دارند</li>
                            </ul>
                        </div>
                    </div>
                `,
                notes: {
                    content: "نشان دهید که خطوط کوانتایل در میانه و دنباله‌ها چگونه رفتار متفاوتی نسبت به OLS دارند.",
                    timing: "3 دقیقه",
                    tips: "اگر نمودار دارید، روی outlierها زوم کنید."
                }
            },

            {
                id: 17,
                title: "مثال عملی ۲",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-database" style="margin-left: 1rem;"></i>مثال ۲: داده‌های واقعی (Engel)</h2>
                        <p style="font-size:1.05rem;">
                            یک مثال کلاسیک، رابطه بین درآمد خانوار و سهم هزینه غذا (Engel Curve) است.
                        </p>
                        <p style="font-size:0.95rem;">
                            رگرسیون کوانتایل نشان می‌دهد که حساسیت سهم هزینه غذا به درآمد در کوانتایل‌های پایین و بالا متفاوت است و این تفاوت با OLS پنهان می‌ماند.
                        </p>
                        <div class="key-insight">
                            <strong>بینش کلیدی:</strong>
                            <p>خانوارهای کم‌درآمد (کوانتایل پایین) حساسیت بیشتری به تغییرات درآمد دارند نسبت به خانوارهای پردرآمد.</p>
                        </div>
                        <div class="info-box">
                            <strong>منبع:</strong>
                            <p>Koenker & Hallock (2001, Journal of Economic Perspectives) - مرور جامع کاربردهای رگرسیون کوانتایل</p>
                        </div>
                    </div>
                `,
                notes: {
                    content: "به مقاله Koenker & Hallock (2001, JEP) اشاره کنید.",
                    timing: "3 دقیقه",
                    tips: "برای هر τ تفسیر اقتصادی بدهید."
                }
            },

            {
                id: 18,
                title: "مقایسه با OLS",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-balance-scale" style="margin-left: 1rem;"></i>مقایسه رگرسیون کوانتایل با OLS</h2>
                        <p style="font-size:1.05rem;">
                            رگرسیون کوانتایل را می‌توان به عنوان تعمیم OLS از «میانگین شرطی» به «کوانتایل‌های شرطی مختلف» دید.
                        </p>
                        <div class="data-table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ویژگی</th>
                                        <th>OLS</th>
                                        <th>رگرسیون کوانتایل</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>هدف</td>
                                        <td>برآورد E[Y|X]</td>
                                        <td>برآورد Q<sub>τ</sub>(Y|X) برای τهای مختلف</td>
                                    </tr>
                                    <tr>
                                        <td>تابع زیان</td>
                                        <td>مجموع مربعات خطا</td>
                                        <td>مجموع زیان کوانتایلی (Pinball Loss)</td>
                                    </tr>
                                    <tr>
                                        <td>حساسیت به Outliers</td>
                                        <td>خیلی حساس</td>
                                        <td>مقاوم‌تر، مخصوصاً برای میانه</td>
                                    </tr>
                                    <tr>
                                        <td>فرض توزیع خطا</td>
                                        <td>تقریباً نرمال</td>
                                        <td>بدون فرض خاص</td>
                                    </tr>
                                    <tr>
                                        <td>ناهمسانی واریانس</td>
                                        <td>مشکل</td>
                                        <td>قابلیت مدل‌سازی مستقیم</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="highlight-quote">
                            OLS یک عدد (میانگین) می‌دهد، اما رگرسیون کوانتایل یک «خانواده» از خطوط برای کل توزیع پاسخ ارائه می‌کند.
                        </div>
                    </div>
                `,
                notes: {
                    content: "۵ معیار مقایسه؛ روی مقاوم بودن QR و مدل‌کردن دنباله‌ها تاکید کنید.",
                    timing: "3 دقیقه",
                    tips: "اگر نمودار دارید، خط OLS و چند خط کوانتایل را هم‌زمان نشان دهید."
                }
            },
            {
                id: 19,
                title: "کاربردهای عملی",
                type: "content",
                timing: 4,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-rocket" style="margin-left: 1rem;"></i>کاربردهای عملی رگرسیون کوانتایل</h2>
                        <p style="font-size:1.05rem;">
                            رگرسیون کوانتایل در حوزه‌های مختلف علمی و صنعتی کاربرد گسترده دارد، از اقتصاد و پزشکی گرفته تا یادگیری ماشین.
                        </p>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #3b82f6;">
                                <h3 style="color: #3b82f6;"><i class="fas fa-chart-line"></i> اقتصاد و مالی</h3>
                                <ul class="enhanced-list">
                                    <li><strong>تحلیل درآمد:</strong> بررسی عوامل مؤثر بر کوانتایل‌های مختلف توزیع درآمد</li>
                                    <li><strong>ریسک مالی:</strong> برآورد Value at Risk (VaR) و Conditional VaR</li>
                                    <li><strong>منحنی Engel:</strong> رابطه درآمد و الگوی مصرف</li>
                                    <li><strong>تحلیل نابرابری:</strong> مطالعه شکاف‌های درآمدی</li>
                                </ul>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #10b981;">
                                <h3 style="color: #10b981;"><i class="fas fa-heartbeat"></i> پزشکی و بهداشت</h3>
                                <ul class="enhanced-list">
                                    <li><strong>نمودارهای رشد:</strong> کوانتایل‌های وزن، قد، و BMI کودکان</li>
                                    <li><strong>اثرات دارو:</strong> تحلیل پاسخ دارویی در بیماران مختلف</li>
                                    <li><strong>عوامل خطر:</strong> شناسایی افراد پرخطر در دنباله‌های توزیع</li>
                                    <li><strong>بقا و پیش‌آگهی:</strong> مدل‌سازی زمان بقا در گروه‌های متفاوت</li>
                                </ul>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #8b5cf6;">
                                <h3 style="color: #8b5cf6;"><i class="fas fa-cloud-sun"></i> محیط زیست</h3>
                                <ul class="enhanced-list">
                                    <li><strong>اقلیم:</strong> مدل‌سازی رویدادهای شدید (دما، بارش)</li>
                                    <li><strong>آلودگی:</strong> تحلیل سطوح حداکثر آلاینده‌ها</li>
                                    <li><strong>منابع آب:</strong> پیش‌بینی جریان رودخانه در شرایط خشک/سیل</li>
                                </ul>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #ec4899;">
                                <h3 style="color: #ec4899;"><i class="fas fa-brain"></i> یادگیری ماشین</h3>
                                <ul class="enhanced-list">
                                    <li><strong>فواصل پیش‌بینی:</strong> Prediction intervals و Uncertainty quantification</li>
                                    <li><strong>Deep Learning:</strong> Deep Quantile Regression برای شبکه‌های عصبی</li>
                                    <li><strong>بهینه‌سازی:</strong> Quantile Loss در مسائل Ranking و Recommender Systems</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "چهار حوزه اصلی: اقتصاد، پزشکی، محیط زیست، ML. برای هر کدام یک مثال بزنید.",
                    timing: "4 دقیقه",
                    tips: "روی Value at Risk و نمودارهای رشد کودکان (WHO) تأکید کنید."
                }
            },

            {
                id: 20,
                title: "معماری ماژولار",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-puzzle-piece" style="margin-left: 1rem;"></i>معماری ماژولار</h2>
                        <p style="font-size:1.05rem;">
                            پیاده‌سازی حرفه‌ای رگرسیون کوانتایل نیازمند معماری ماژولار، قابل توسعه، و قابل تست است.
                        </p>
                        <div class="grid-3">
                            <div class="grid-card">
                                <h3 style="color: #3b82f6;">Data Layer</h3>
                                <p style="font-size:0.9rem;">مدیریت ورودی، پیش‌پردازش، و اعتبارسنجی داده‌ها</p>
                                <ul style="font-size:0.85rem;">
                                    <li>Data loaders</li>
                                    <li>Validation checks</li>
                                    <li>Preprocessing pipeline</li>
                                </ul>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #8b5cf6;">Model Layer</h3>
                                <p style="font-size:0.9rem;">پیاده‌سازی انواع مدل‌های کوانتایل</p>
                                <ul style="font-size:0.85rem;">
                                    <li>Linear QR</li>
                                    <li>Local/Kernel QR</li>
                                    <li>Spline QR</li>
                                </ul>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #10b981;">Optimization Layer</h3>
                                <p style="font-size:0.9rem;">الگوریتم‌های بهینه‌سازی مختلف</p>
                                <ul style="font-size:0.85rem;">
                                    <li>Simplex solver</li>
                                    <li>Interior point</li>
                                    <li>Gradient descent</li>
                                </ul>
                            </div>
                        </div>
                        <div class="info-box">
                            <strong>اصل SOLID:</strong>
                            <p>هر ماژول یک مسئولیت واحد دارد و به سایر ماژول‌ها از طریق interface وابسته است، نه پیاده‌سازی مشخص.</p>
                        </div>
                    </div>
                `,
                notes: {
                    content: "سه لایه اصلی: Data، Model، Optimization. اصول SOLID را توضیح دهید.",
                    timing: "3 دقیقه",
                    tips: "یک نمودار ساده از ارتباط لایه‌ها بکشید."
                }
            },

            {
                id: 21,
                title: "الگوهای طراحی",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-drafting-compass" style="margin-left: 1rem;"></i>الگوهای طراحی (Design Patterns)</h2>
                        <p style="font-size:1.05rem;">
                            استفاده از الگوهای طراحی شناخته‌شده، کد را سازمان‌یافته‌تر، قابل نگهداری‌تر، و مقیاس‌پذیرتر می‌کند.
                        </p>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #3b82f6;">
                                <h3 style="color: #3b82f6;">Strategy Pattern</h3>
                                <p style="font-size:0.9rem;">
                                    انتخاب الگوریتم بهینه‌سازی یا مدل در runtime بدون تغییر کد اصلی.
                                </p>
                                <div class="code-snippet" style="margin-top:1rem;">
                                    <code style="font-size:0.85rem;">
                                    model.set_solver("simplex")<br>
                                    model.fit(X, y, tau=0.5)
                                    </code>
                                </div>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #8b5cf6;">
                                <h3 style="color: #8b5cf6;">Factory Pattern</h3>
                                <p style="font-size:0.9rem;">
                                    ساخت اشیاء (مدل‌ها، solverها) از طریق factory به جای نمونه‌سازی مستقیم.
                                </p>
                                <div class="code-snippet" style="margin-top:1rem;">
                                    <code style="font-size:0.85rem;">
                                    model = ModelFactory.create("local_qr")<br>
                                    solver = SolverFactory.create("interior_point")
                                    </code>
                                </div>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #10b981;">
                                <h3 style="color: #10b981;">Observer Pattern</h3>
                                <p style="font-size:0.9rem;">
                                    برای لاگ کردن و monitoring روند بهینه‌سازی و آموزش مدل.
                                </p>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #ec4899;">
                                <h3 style="color: #ec4899;">Template Method</h3>
                                <p style="font-size:0.9rem;">
                                    تعریف اسکلت عمومی فرآیند fit و predict در کلاس پایه و سفارشی‌سازی در زیرکلاس‌ها.
                                </p>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "چهار الگو: Strategy، Factory، Observer، Template. مثال کد بزنید.",
                    timing: "3 دقیقه",
                    tips: "Strategy و Factory بیشترین کاربرد را دارند."
                }
            },

            {
                id: 22,
                title: "بهینه‌سازی کارایی",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-tachometer-alt" style="margin-left: 1rem;"></i>بهینه‌سازی کارایی</h2>
                        <p style="font-size:1.05rem;">
                            در مقیاس بزرگ، کارایی و سرعت اجرای کد بسیار حیاتی است. تکنیک‌های زیر برای افزایش سرعت استفاده می‌شوند:
                        </p>
                        <div class="grid-3">
                            <div class="grid-card">
                                <h3 style="color: #3b82f6;">Vectorization</h3>
                                <p style="font-size:0.9rem;">
                                    استفاده از NumPy و عملیات‌های برداری به جای حلقه‌های Python
                                </p>
                                <p style="font-size:0.8rem; opacity:0.7;">تا ۱۰۰x سریع‌تر</p>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #8b5cf6;">Parallelization</h3>
                                <p style="font-size:0.9rem;">
                                    محاسبه همزمان چند کوانتایل روی چند هسته یا GPU
                                </p>
                                <p style="font-size:0.8rem; opacity:0.7;">Linear speedup</p>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #10b981;">Caching</h3>
                                <p style="font-size:0.9rem;">
                                    ذخیره‌سازی نتایج محاسبات تکراری (مثل matrixes داده)
                                </p>
                                <p style="font-size:0.8rem; opacity:0.7;">کاهش I/O</p>
                            </div>
                        </div>
                        <div class="info-box">
                            <strong>نکته کلیدی:</strong>
                            <p>پروفایل کردن کد (profiling) قبل از بهینه‌سازی ضروری است تا بفهمیم کجا وقت بیشتری صرف می‌شود (bottlenecks).</p>
                        </div>
                        <div class="code-snippet">
                            <code style="font-size:0.85rem;">
                            <span class="comment"># مثال Vectorization با NumPy</span><br>
                            <span class="keyword">import</span> numpy <span class="keyword">as</span> np<br>
                            residuals = y - X @ beta  <span class="comment"># به جای حلقه</span>
                            </code>
                        </div>
                    </div>
                `,
                notes: {
                    content: "سه تکنیک: Vectorization، Parallelization، Caching. اهمیت Profiling.",
                    timing: "3 دقیقه",
                    tips: "یک مثال کد قبل/بعد بهینه‌سازی نشان دهید."
                }
            },

            {
                id: 23,
                title: "کیفیت و تست کد",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-check-double" style="margin-left: 1rem;"></i>کیفیت و تست کد</h2>
                        <p style="font-size:1.05rem;">
                            کیفیت کد در پروژه‌های علمی و صنعتی اهمیت بالایی دارد. باید از رویکردهای استاندارد تست و مستندسازی استفاده شود.
                        </p>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #3b82f6;">
                                <h3 style="color: #3b82f6;">Unit Testing</h3>
                                <p style="font-size:0.9rem;">
                                    تست واحدهای کوچک کد (توابع، کلاس‌ها) به صورت مجزا با pytest یا unittest.
                                </p>
                                <div class="code-snippet" style="margin-top:0.8rem;">
                                    <code style="font-size:0.8rem;">
                                    <span class="keyword">def</span> test_quantile_loss():<br>
                                    &nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">assert</span> loss(0, tau=0.5) == 0
                                    </code>
                                </div>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #8b5cf6;">
                                <h3 style="color: #8b5cf6;">Integration Testing</h3>
                                <p style="font-size:0.9rem;">
                                    تست تعامل بین ماژول‌ها و pipeline کامل (از ورودی تا خروجی).
                                </p>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #10b981;">
                                <h3 style="color: #10b981;">Code Coverage</h3>
                                <p style="font-size:0.9rem;">
                                    اندازه‌گیری درصد کدی که توسط تست‌ها پوشش داده می‌شود. هدف: بالای ۸۰٪.
                                </p>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #ec4899;">
                                <h3 style="color: #ec4899;">Documentation</h3>
                                <p style="font-size:0.9rem;">
                                    مستندسازی کامل با Docstrings (Google/NumPy style) و Sphinx.
                                </p>
                            </div>
                        </div>
                        <div class="warning-box">
                            <strong>اصل طلایی:</strong> کدی که تست نشده، شکسته فرض می‌شود.
                        </div>
                    </div>
                `,
                notes: {
                    content: "چهار جنبه کیفیت: Unit Test، Integration Test، Coverage، Documentation.",
                    timing: "3 دقیقه",
                    tips: "بگویید Coverage بالای ۸۰٪ استاندارد است."
                }
            },

            {
                id: 24,
                title: "ابزارها و کتابخانه‌ها",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-toolbox" style="margin-left: 1rem;"></i>ابزارها و کتابخانه‌های موجود</h2>
                        <p style="font-size:1.05rem;">
                            در زبان‌های مختلف برنامه‌نویسی، کتابخانه‌های بالغ و پرکاربردی برای رگرسیون کوانتایل وجود دارند.
                        </p>
                        <div class="grid-3">
                            <div class="grid-card">
                                <h3 style="color: #3b82f6;"><i class="fab fa-r-project"></i> R</h3>
                                <ul style="font-size:0.9rem;">
                                    <li><strong>quantreg:</strong> بسته اصلی توسط Roger Koenker</li>
                                    <li><strong>rqPen:</strong> برای رگرسیون کوانتایل با Regularization</li>
                                    <li><strong>quantregForest:</strong> کوانتایل در Random Forest</li>
                                </ul>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #f59e0b;"><i class="fab fa-python"></i> Python</h3>
                                <ul style="font-size:0.9rem;">
                                    <li><strong>statsmodels.regression.quantile_regression:</strong> پیاده‌سازی استاندارد</li>
                                    <li><strong>scikit-learn (GradientBoostingRegressor):</strong> با loss='quantile'</li>
                                    <li><strong>LightGBM/XGBoost:</strong> با objective='quantile'</li>
                                </ul>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #8b5cf6;"><i class="fas fa-code"></i> Julia</h3>
                                <ul style="font-size:0.9rem;">
                                    <li><strong>QuantileRegression.jl:</strong> پیاده‌سازی سریع</li>
                                    <li>مزیت: سرعت بالا برای داده‌های بزرگ</li>
                                </ul>
                            </div>
                        </div>
                        <div class="info-box">
                            <strong>توصیه:</strong>
                            <ul class="enhanced-list">
                                <li>برای تحقیقات آماری و اقتصادی → <strong>R/quantreg</strong></li>
                                <li>برای پروژه‌های ML و داده‌کاوی → <strong>Python/scikit-learn</strong> یا <strong>LightGBM</strong></li>
                                <li>برای محاسبات عددی سنگین → <strong>Julia</strong></li>
                            </ul>
                        </div>
                    </div>
                `,
                notes: {
                    content: "سه زبان اصلی: R (quantreg)، Python (statsmodels، sklearn)، Julia. توصیه کنید بسته به حوزه انتخاب کنند.",
                    timing: "3 دقیقه",
                    tips: "اگر کد نمونه دارید، یک مثال کوتاه از quantreg (R) یا statsmodels (Python) نشان دهید."
                }
            },

            {
                id: 25,
                title: "چالش‌ها و محدودیت‌ها",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-exclamation-circle" style="margin-left: 1rem;"></i>چالش‌ها و محدودیت‌های رگرسیون کوانتایل</h2>
                        <p style="font-size:1.05rem;">
                            با وجود مزایای فراوان، رگرسیون کوانتایل چالش‌ها و محدودیت‌هایی نیز دارد که باید در نظر گرفته شوند.
                        </p>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #ef4444;">
                                <h3 style="color: #ef4444;">هزینه محاسباتی</h3>
                                <p style="font-size:0.95rem;">
                                    حل مسئله LP یا بهینه‌سازی برای کوانتایل‌های متعدد می‌تواند زمان‌بر باشد، مخصوصاً در ابعاد بالا.
                                </p>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #f59e0b;">
                                <h3 style="color: #f59e0b;">Quantile Crossing</h3>
                                <p style="font-size:0.95rem;">
                                    برآورد جداگانه ممکن است منجر به تقاطع نامنطقی کوانتایل‌ها شود که نیاز به روش‌های تصحیح دارد.
                                </p>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #8b5cf6;">
                                <h3 style="color: #8b5cf6;">تفسیر پیچیده‌تر</h3>
                                <p style="font-size:0.95rem;">
                                    نسبت به OLS، تفسیر و ارائه نتایج برای مخاطب غیرفنی چالش‌برانگیزتر است.
                                </p>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #ec4899;">
                                <h3 style="color: #ec4899;">نیاز به حجم داده بیشتر</h3>
                                <p style="font-size:0.95rem;">
                                    برای برآورد پایدار کوانتایل‌های دنباله (مثلاً τ=0.05 یا 0.95)، به تعداد مشاهدات بیشتری نیاز است.
                                </p>
                            </div>
                        </div>
                        <div class="warning-box">
                            <strong>نکته مهم:</strong>
                            <p>در عمل، این چالش‌ها با انتخاب روش مناسب، الگوریتم کارآمد، و preprocessing دقیق قابل مدیریت هستند.</p>
                        </div>
                    </div>
                `,
                notes: {
                    content: "چهار چالش: هزینه محاسباتی، Crossing، تفسیر پیچیده‌تر، نیاز به داده بیشتر.",
                    timing: "3 دقیقه",
                    tips: "بگویید این‌ها مانع استفاده نیستند بلکه نیاز به دقت بیشتر دارند."
                }
            },

            {
                id: 26,
                title: "آینده رگرسیون کوانتایل",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-rocket" style="margin-left: 1rem;"></i>آینده و جهت‌گیری‌های تحقیقاتی</h2>
                        <p style="font-size:1.05rem;">
                            رگرسیون کوانتایل در حال تکامل است و حوزه‌های جدید و هیجان‌انگیزی پیش رو دارد.
                        </p>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #3b82f6;">
                                <h3 style="color: #3b82f6;"><i class="fas fa-brain"></i> Deep Quantile Regression</h3>
                                <p style="font-size:0.9rem;">
                                    ترکیب رگرسیون کوانتایل با شبکه‌های عصبی عمیق برای مدل‌سازی روابط بسیار پیچیده و غیرخطی.
                                </p>
                                <p style="font-size:0.85rem; opacity:0.7;">کاربرد در CV، NLP، Time Series</p>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #10b981;">
                                <h3 style="color: #10b981;"><i class="fas fa-shield-alt"></i> Conformal Prediction</h3>
                                <p style="font-size:0.9rem;">
                                    ترکیب رگرسیون کوانتایل با Conformal Inference برای ساخت فواصل اطمینان بدون فرض توزیع.
                                </p>
                                <p style="font-size:0.85rem; opacity:0.7;">Uncertainty Quantification دقیق‌تر</p>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="grid-card" style="border-right: 4px solid #8b5cf6;">
                                <h3 style="color: #8b5cf6;"><i class="fas fa-database"></i> Scalable QR</h3>
                                <p style="font-size:0.9rem;">
                                    الگوریتم‌های مقیاس‌پذیر برای Big Data و محاسبات توزیع‌شده (Distributed Computing).
                                </p>
                            </div>
                            <div class="grid-card" style="border-right: 4px solid #ec4899;">
                                <h3 style="color: #ec4899;"><i class="fas fa-chart-line"></i> Causal Inference</h3>
                                <p style="font-size:0.9rem;">
                                    استفاده از رگرسیون کوانتایل برای تحلیل اثرات علّی ناهمگن (Heterogeneous Treatment Effects).
                                </p>
                            </div>
                        </div>
                        <div class="highlight-quote">
                            "رگرسیون کوانتایل هم‌اکنون یک ابزار استاندارد است و در آینده با تلفیق با AI و ML، کاربردهای بیشتری خواهد یافت."
                        </div>
                    </div>
                `,
                notes: {
                    content: "چهار جهت آینده: Deep QR، Conformal Prediction، Scalable QR، Causal Inference.",
                    timing: "3 دقیقه",
                    tips: "روی Deep Learning + Quantile Regression تأکید کنید چون بسیار داغ است."
                }
            },
            {
                id: 27,
                title: "نمونه کد Python",
                type: "content",
                timing: 4,
                content: `
                    <div class="slide-content">
                        <h2><i class="fab fa-python" style="margin-left: 1rem;"></i>نمونه کد: Python با statsmodels</h2>
                        <p style="font-size:1.05rem;">
                            یک مثال کامل از پیاده‌سازی رگرسیون کوانتایل در Python با استفاده از کتابخانه statsmodels.
                        </p>
                        <div class="code-block">
                            <code>
<span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">import</span> pandas <span class="keyword">as</span> pd
<span class="keyword">import</span> statsmodels.formula.api <span class="keyword">as</span> smf
<span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt

<span class="comment"># تولید داده شبیه‌سازی شده</span>
np.random.seed(42)
n = 200
X = np.random.uniform(0, 10, n)
y = 2 + 1.5*X + np.random.laplace(0, 2, n)  <span class="comment"># خطا از توزیع Laplace</span>

df = pd.DataFrame({'X': X, 'y': y})

<span class="comment"># برازش رگرسیون کوانتایل برای τ های مختلف</span>
quantiles = [0.1, 0.25, 0.5, 0.75, 0.9]
models = {}

<span class="keyword">for</span> q <span class="keyword">in</span> quantiles:
    model = smf.quantreg(<span class="string">'y ~ X'</span>, df)
    results = model.fit(q=q)
    models[q] = results
    <span class="keyword">print</span>(<span class="string">f'τ={q}: β₀={results.params[0]:.2f}, β₁={results.params[1]:.2f}'</span>)

<span class="comment"># رسم نتایج</span>
plt.scatter(X, y, alpha=0.3, label=<span class="string">'Data'</span>)
<span class="keyword">for</span> q <span class="keyword">in</span> quantiles:
    y_pred = models[q].predict(df)
    plt.plot(X, y_pred, label=<span class="string">f'τ={q}'</span>)
plt.legend()
plt.xlabel(<span class="string">'X'</span>)
plt.ylabel(<span class="string">'y'</span>)
plt.title(<span class="string">'Quantile Regression'</span>)
plt.show()
                            </code>
                        </div>
                    </div>
                `,
                notes: {
                    content: "کد را خط به خط توضیح دهید. روی تفاوت ضرایب در τهای مختلف تأکید کنید.",
                    timing: "4 دقیقه",
                    tips: "اگر محیط اجرا دارید، کد را live اجرا کنید."
                }
            },

            {
                id: 28,
                title: "نمونه کد R",
                type: "content",
                timing: 4,
                content: `
                    <div class="slide-content">
                        <h2><i class="fab fa-r-project" style="margin-left: 1rem;"></i>نمونه کد: R با quantreg</h2>
                        <p style="font-size:1.05rem;">
                            همان مثال قبل، اما با استفاده از بسته quantreg در R (بسته استاندارد طلایی رگرسیون کوانتایل).
                        </p>
                        <div class="code-block">
                            <code>
<span class="comment"># نصب و بارگذاری بسته</span>
<span class="keyword">library</span>(quantreg)

<span class="comment"># تولید داده شبیه‌سازی شده</span>
<span class="keyword">set.seed</span>(42)
n <- 200
X <- <span class="keyword">runif</span>(n, 0, 10)
y <- 2 + 1.5*X + <span class="keyword">rlaplace</span>(n, 0, 2)  <span class="comment"># خطا از توزیع Laplace</span>

df <- <span class="keyword">data.frame</span>(X = X, y = y)

<span class="comment"># برازش رگرسیون کوانتایل</span>
quantiles <- <span class="keyword">c</span>(0.1, 0.25, 0.5, 0.75, 0.9)

<span class="keyword">for</span>(q <span class="keyword">in</span> quantiles) {
  model <- <span class="keyword">rq</span>(y ~ X, data = df, tau = q)
  <span class="keyword">cat</span>(<span class="string">sprintf("τ=%.2f: β₀=%.2f, β₁=%.2f\\n"</span>, 
              q, <span class="keyword">coef</span>(model)[1], <span class="keyword">coef</span>(model)[2]))
}

<span class="comment"># رسم نتایج</span>
<span class="keyword">plot</span>(X, y, pch=16, col=<span class="keyword">rgb</span>(0,0,0,0.3), 
     xlab=<span class="string">"X"</span>, ylab=<span class="string">"y"</span>, main=<span class="string">"Quantile Regression (R)"</span>)

colors <- <span class="keyword">c</span>(<span class="string">"red"</span>, <span class="string">"orange"</span>, <span class="string">"green"</span>, <span class="string">"blue"</span>, <span class="string">"purple"</span>)
<span class="keyword">for</span>(i <span class="keyword">in</span> 1:<span class="keyword">length</span>(quantiles)) {
  model <- <span class="keyword">rq</span>(y ~ X, data = df, tau = quantiles[i])
  <span class="keyword">abline</span>(model, col=colors[i], lwd=2)
}
<span class="keyword">legend</span>(<span class="string">"topleft"</span>, legend=<span class="keyword">paste0</span>(<span class="string">"τ="</span>, quantiles), 
       col=colors, lwd=2)
                            </code>
                        </div>
                    </div>
                `,
                notes: {
                    content: "بسته quantreg توسط Roger Koenker نوشته شده. تابع rq() برای برازش استفاده می‌شود.",
                    timing: "4 دقیقه",
                    tips: "مقایسه کوتاه syntaxهای Python و R."
                }
            },

            {
                id: 29,
                title: "مثال Regularization",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-sliders-h" style="margin-left: 1rem;"></i>مثال: رگرسیون کوانتایل با Regularization</h2>
                        <p style="font-size:1.05rem;">
                            استفاده از L1 Regularization (LASSO) برای انتخاب متغیر در رگرسیون کوانتایل با ابعاد بالا.
                        </p>
                        <div class="code-block">
                            <code>
<span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> QuantileRegressor
<span class="keyword">import</span> numpy <span class="keyword">as</span> np

<span class="comment"># داده با 50 متغیر (فقط 5 تا اثرگذار)</span>
np.random.seed(123)
n, p = 300, 50
X = np.random.randn(n, p)
<span class="comment"># فقط 5 متغیر اول تأثیرگذارند</span>
true_coef = np.concatenate([np.array([3, -2, 1.5, 2.5, -1]), np.zeros(45)])
y = X @ true_coef + np.random.laplace(0, 1, n)

<span class="comment"># رگرسیون کوانتایل با L1 penalty (alpha کنترل شدت regularization)</span>
model = QuantileRegressor(quantile=0.5, alpha=0.1, solver=<span class="string">'highs'</span>)
model.fit(X, y)

<span class="comment"># بررسی ضرایب: بسیاری صفر شده‌اند</span>
nonzero_coef = np.sum(model.coef_ != 0)
<span class="keyword">print</span>(<span class="string">f'تعداد ضرایب غیرصفر: {nonzero_coef} از {p}'</span>)
<span class="keyword">print</span>(<span class="string">f'ضرایب اول (واقعی غیرصفر): {model.coef_[:5]}'</span>)
                            </code>
                        </div>
                        <div class="info-box">
                            <strong>نتیجه:</strong>
                            <p>با L1 Regularization، از ۵۰ متغیر، فقط چند متغیر مهم باقی می‌مانند و بقیه ضریب صفر می‌گیرند → انتخاب خودکار متغیر.</p>
                        </div>
                    </div>
                `,
                notes: {
                    content: "نشان دهید چطور از 50 متغیر، فقط 5-7 تا باقی می‌مانند.",
                    timing: "3 دقیقه",
                    tips: "alpha کوچک → کمتر Regularization، alpha بزرگ → بیشتر صفر شدن."
                }
            },

            {
                id: 30,
                title: "مثال Kernel Quantile Regression",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-wave-square" style="margin-left: 1rem;"></i>مثال: Kernel Quantile Regression</h2>
                        <p style="font-size:1.05rem;">
                            در این مثال، از یک رابطه غیرخطی سینوسی استفاده می‌کنیم و با Kernel Local QR آن را مدل می‌کنیم.
                        </p>
                        <div class="code-block">
                            <code>
<span class="keyword">import</span> numpy <span class="keyword">as</span> np
<span class="keyword">from</span> scipy.stats <span class="keyword">import</span> norm

<span class="comment"># تولید داده غیرخطی</span>
np.random.seed(99)
n = 300
X = np.sort(np.random.uniform(0, 4*np.pi, n))
y_true = np.sin(X)
y = y_true + np.random.normal(0, 0.3, n)

<span class="comment"># تابع Kernel Gaussian</span>
<span class="keyword">def</span> gaussian_kernel(u, bandwidth=0.5):
    <span class="keyword">return</span> norm.pdf(u / bandwidth) / bandwidth

<span class="comment"># Local Quantile Regression برای τ=0.5 (میانه)</span>
<span class="keyword">def</span> local_qr(X_train, y_train, X_test, tau=0.5, bandwidth=0.5):
    predictions = []
    <span class="keyword">for</span> x0 <span class="keyword">in</span> X_test:
        weights = gaussian_kernel(X_train - x0, bandwidth)
        <span class="comment"># حل مسئله وزن‌دار کوانتایل</span>
        <span class="comment"># (در عمل از کتابخانه استفاده می‌شود)</span>
        q_pred = np.quantile(y_train, tau)  <span class="comment"># ساده‌سازی شده</span>
        predictions.append(q_pred)
    <span class="keyword">return</span> np.array(predictions)

<span class="comment"># پیش‌بینی</span>
y_pred = local_qr(X, y, X, tau=0.5, bandwidth=0.5)
<span class="keyword">print</span>(<span class="string">'Kernel QR fit completed!'</span>)
                            </code>
                        </div>
                        <p style="font-size:0.9rem; opacity:0.8; margin-top:1rem;">
                            <strong>نکته:</strong> این کد ساده‌سازی شده است. در عمل از کتابخانه‌های تخصصی استفاده می‌شود.
                        </p>
                    </div>
                `,
                notes: {
                    content: "Kernel Local QR برای روابط غیرخطی. Bandwidth کنترل می‌کند محلی بودن را.",
                    timing: "3 دقیقه",
                    tips: "توضیح دهید که این کد مفهومی است، در عمل از quantregForest یا کتابخانه مشابه استفاده می‌شود."
                }
            },

            {
                id: 31,
                title: "بهترین شیوه‌ها (Best Practices)",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-thumbs-up" style="margin-left: 1rem;"></i>بهترین شیوه‌های پیاده‌سازی</h2>
                        <p style="font-size:1.05rem;">
                            برای موفقیت در پیاده‌سازی و استفاده از رگرسیون کوانتایل، این نکات را رعایت کنید:
                        </p>
                        <div class="grid-2">
                            <div class="grid-card">
                                <h3 style="color: #10b981;">✓ کارهای توصیه‌شده</h3>
                                <ul class="enhanced-list">
                                    <li>داده را Standardize کنید (میانگین=0، واریانس=1)</li>
                                    <li>چند کوانتایل (مثلاً 0.1, 0.5, 0.9) را با هم ترسیم کنید</li>
                                    <li>از Cross-validation برای انتخاب hyperparameter استفاده کنید</li>
                                    <li>نتایج را تصویرسازی کنید (چشمی بررسی Crossing)</li>
                                    <li>کد را modular و testable طراحی کنید</li>
                                </ul>
                            </div>
                            <div class="grid-card">
                                <h3 style="color: #ef4444;">✗ کارهای غیرتوصیه‌شده</h3>
                                <ul class="enhanced-list">
                                    <li>تنها یک کوانتایل را برآورد کنید (اطلاعات ناقص)</li>
                                    <li>Quantile Crossing را نادیده بگیرید</li>
                                    <li>برای κوانتایل‌های دنباله (τ=0.01) با داده کم کار کنید</li>
                                    <li>Outlierها را بدون بررسی حذف کنید</li>
                                    <li>فرض کنید ضرایب برای همه τها یکسان هستند</li>
                                </ul>
                            </div>
                        </div>
                        <div class="key-insight">
                            <strong>نکته کلیدی:</strong> رگرسیون کوانتایل یک «خانواده از مدل‌ها» است، نه یک مدل واحد. همیشه چندین τ را بررسی کنید.
                        </div>
                    </div>
                `,
                notes: {
                    content: "Do's و Don'ts را به وضوح بیان کنید. استانداردسازی داده خیلی مهم است.",
                    timing: "3 دقیقه",
                    tips: "به مخاطبین بگویید از visualization غافل نشوند."
                }
            },

            {
                id: 32,
                title: "منابع یادگیری بیشتر",
                type: "content",
                timing: 2,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-book-reader" style="margin-left: 1rem;"></i>منابع یادگیری بیشتر</h2>
                        <p style="font-size:1.05rem;">
                            برای یادگیری عمیق‌تر و مطالعه بیشتر، این منابع را توصیه می‌کنیم:
                        </p>
                        <div class="references">
                            <div class="reference-item">
                                <strong>📚 کتاب‌ها:</strong>
                                <ul style="margin-top:0.5rem;">
                                    <li>Koenker, R. (2005). <em>Quantile Regression</em>. Cambridge University Press.</li>
                                    <li>Davino, C., Furno, M., & Vistocco, D. (2013). <em>Quantile Regression: Theory and Applications</em>.</li>
                                </ul>
                            </div>
                            <div class="reference-item">
                                <strong>📄 مقالات کلیدی:</strong>
                                <ul style="margin-top:0.5rem;">
                                    <li>Koenker, R., & Bassett, G. (1978). Regression Quantiles. <em>Econometrica</em>, 46(1), 33-50.</li>
                                    <li>Koenker, R., & Hallock, K. F. (2001). Quantile Regression. <em>Journal of Economic Perspectives</em>, 15(4), 143-156.</li>
                                    <li>Chernozhukov, V., Fernández‐Val, I., & Galichon, A. (2010). Quantile and Probability Curves Without Crossing. <em>Econometrica</em>, 78(3), 1093-1125.</li>
                                </ul>
                            </div>
                            <div class="reference-item">
                                <strong>🌐 منابع آنلاین:</strong>
                                <ul style="margin-top:0.5rem;">
                                    <li><a href="https://www.econ.uiuc.edu/~roger/research/rq/rq.html" target="_blank" style="color:#60a5fa;">صفحه Roger Koenker</a></li>
                                    <li><a href="https://cran.r-project.org/web/packages/quantreg/vignettes/rq.pdf" target="_blank" style="color:#60a5fa;">مستندات بسته quantreg</a></li>
                                    <li><a href="https://www.statsmodels.org/stable/quantile_regression.html" target="_blank" style="color:#60a5fa;">مستندات statsmodels (Python)</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "سه دسته منبع: کتاب‌ها، مقالات، آنلاین. مقاله 1978 کلاسیک است.",
                    timing: "2 دقیقه",
                    tips: "به مخاطبین بگویید مقاله JEP 2001 برای شروع عالی است (مروری جامع)."
                }
            },

            {
                id: 33,
                title: "سوالات متداول (FAQ)",
                type: "content",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-question-circle" style="margin-left: 1rem;"></i>سوالات متداول (FAQ)</h2>
                        <p style="font-size:1.05rem;">
                            پاسخ به رایج‌ترین سوالاتی که درباره رگرسیون کوانتایل پرسیده می‌شود:
                        </p>
                        <div style="display:flex; flex-direction:column; gap:1rem;">
                            <div class="info-box">
                                <strong>❓ چرا رگرسیون کوانتایل به جای OLS؟</strong>
                                <p style="margin-top:0.5rem;">
                                    OLS فقط میانگین را می‌دهد. اگر می‌خواهید توزیع کامل را ببینید یا رفتار دنباله‌ها را مطالعه کنید، رگرسیون کوانتایل لازم است.
                                </p>
                            </div>
                            <div class="info-box">
                                <strong>❓ کدام τها را انتخاب کنم؟</strong>
                                <p style="margin-top:0.5rem;">
                                    معمولاً τ = 0.1, 0.25, 0.5, 0.75, 0.9 خوب است. برای دنباله‌های شدید τ = 0.05, 0.95 یا حتی 0.01, 0.99.
                                </p>
                            </div>
                            <div class="info-box">
                                <strong>❓ چطور Quantile Crossing را برطرف کنم؟</strong>
                                <p style="margin-top:0.5rem;">
                                    از روش‌های Rearrangement یا Monotone Constraints استفاده کنید. مقاله Chernozhukov et al. (2010) را ببینید.
                                </p>
                            </div>
                            <div class="info-box">
                                <strong>❓ آیا می‌توانم رگرسیون کوانتایل را با Deep Learning ترکیب کنم؟</strong>
                                <p style="margin-top:0.5rem;">
                                    بله! Deep Quantile Regression با استفاده از Pinball Loss در شبکه‌های عصبی ممکن است. در PyTorch/TensorFlow قابل پیاده‌سازی.
                                </p>
                            </div>
                            <div class="info-box">
                                <strong>❓ چقدر داده لازم است؟</strong>
                                <p style="margin-top:0.5rem;">
                                    برای کوانتایل‌های میانی (0.25-0.75) مثل OLS. برای دنباله‌ها (0.05, 0.95) حداقل چند صد مشاهده.
                                </p>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "پنج سوال متداول. به هر کدام به صورت خلاصه و عملی پاسخ دهید.",
                    timing: "3 دقیقه",
                    tips: "اگر وقت دارید، سوالات مخاطبین را بپرسید."
                }
            },

            {
                id: 34,
                title: "جمع‌بندی و تشکر",
                type: "content",
                timing: 2,
                content: `
                    <div class="slide-content">
                        <div class="slide-title">
                            <i class="fas fa-flag-checkered" style="font-size: 3rem; color: #10b981; margin-bottom: 1rem;"></i>
                            <h1 style="font-size: 2.5rem;">جمع‌بندی</h1>
                            <div style="max-width: 900px; margin: 2rem auto; text-align: right;">
                                <div class="key-insight" style="text-align: center; font-size: 1.1rem;">
                                    <strong>نکات کلیدی این ارائه:</strong>
                                    <ul style="text-align: right; display: inline-block; margin-top: 1rem;">
                                        <li>رگرسیون کوانتایل توزیع کامل Y|X را مدل می‌کند، نه فقط میانگین</li>
                                        <li>قوی در برابر Outliers و فرضیات توزیعی ضعیف‌تر نسبت به OLS</li>
                                        <li>کاربردهای گسترده در اقتصاد، پزشکی، محیط زیست، و یادگیری ماشین</li>
                                        <li>پیاده‌سازی حرفه‌ای نیاز به معماری ماژولار و تست دارد</li>
                                        <li>آینده: Deep Quantile Regression و Conformal Prediction</li>
                                    </ul>
                                </div>
                            </div>
                            <div style="margin: 3rem 0; padding: 2rem; background: rgba(59, 130, 246, 0.1); border-radius: 12px; border: 2px solid var(--primary);">
                                <h2 style="color: var(--primary); margin-bottom: 1rem;">
                                    <i class="fas fa-heart"></i> تشکر و قدردانی
                                </h2>
                                <p style="font-size: 1.1rem; line-height: 1.8;">
                                    از توجه شما عزیزان سپاسگزاریم. امیدواریم این ارائه برایتان مفید بوده باشد.
                                </p>
                                <div style="display: flex; justify-content: center; gap: 2rem; margin-top: 2rem; flex-wrap: wrap;">
                                    <div class="info-card" style="min-width: 200px;">
                                        <div class="label">سازنده ارائه</div>
                                        <div class="value">امیرعلی سطوتی</div>
                                    </div>
                                    <div class="info-card" style="min-width: 200px;">
                                        <div class="label">ارائه‌دهنده</div>
                                        <div class="value">نیلوفر سادات شکوهی</div>
                                    </div>
                                    <div class="info-card" style="min-width: 200px;">
                                        <div class="label">استاد درس</div>
                                        <div class="value">دکتر مهدی عمادی</div>
                                    </div>
                                </div>
                            </div>
                            <div style="margin-top: 2rem;">
                                <p style="font-size: 1rem; opacity: 0.7;">
                                    <i class="fas fa-university"></i> دانشگاه فردوسی مشهد • دانشکده علوم ریاضی • گروه آمار
                                </p>
                                <p style="font-size: 1rem; opacity: 0.7; margin-top: 0.5rem;">
                                    <i class="fas fa-calendar"></i> سال تحصیلی ۱۴۰۴
                                </p>
                            </div>
                            <div class="highlight-quote" style="margin-top: 2rem;">
                                <i class="fas fa-quote-right" style="margin-left: 0.5rem;"></i>
                                سوالات، نظرات و پیشنهادات شما را با آغوش باز می‌پذیریم
                                <i class="fas fa-quote-left" style="margin-right: 0.5rem;"></i>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "خلاصه کلیدی‌ترین نکات و تشکر. فضا برای سوالات باز کنید.",
                    timing: "2 دقیقه",
                    tips: "با انرژی و لبخند تمام کنید. از مخاطبین تشکر کنید."
                }
            },
            
            {
                id: 35,
                title: "نظرسنجی از شما",
                type: "poll",
                timing: 3,
                content: `
                    <div class="slide-content">
                        <h2><i class="fas fa-poll" style="margin-left: 1rem;"></i>نظرسنجی: نظر شما برای ما مهم است!</h2>
                        <p style="font-size:1.05rem; margin-bottom: 2rem;">
                            لطفاً نظر خود درباره این ارائه را با ما در میان بگذارید. پاسخ شما به بهبود ارائه‌های آینده کمک می‌کند.
                        </p>
                        
                        <form id="surveyForm" style="display: flex; flex-direction: column; gap: 2rem;">
                            
                            <!-- سوال 1: رضایت کلی -->
                            <div class="survey-question">
                                <h3 style="color: var(--primary); margin-bottom: 1rem;">
                                    <i class="fas fa-star"></i> میزان رضایت کلی شما از ارائه؟
                                </h3>
                                <div style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center;">
                                    <label class="poll-option" style="flex: 1; min-width: 150px; justify-content: center;">
                                        <input type="radio" name="satisfaction" value="5" required style="margin-left: 0.5rem;">
                                        <span class="poll-icon">😍</span>
                                        <span>عالی</span>
                                    </label>
                                    <label class="poll-option" style="flex: 1; min-width: 150px; justify-content: center;">
                                        <input type="radio" name="satisfaction" value="4">
                                        <span class="poll-icon">😊</span>
                                        <span>خوب</span>
                                    </label>
                                    <label class="poll-option" style="flex: 1; min-width: 150px; justify-content: center;">
                                        <input type="radio" name="satisfaction" value="3">
                                        <span class="poll-icon">😐</span>
                                        <span>متوسط</span>
                                    </label>
                                    <label class="poll-option" style="flex: 1; min-width: 150px; justify-content: center;">
                                        <input type="radio" name="satisfaction" value="2">
                                        <span class="poll-icon">😕</span>
                                        <span>ضعیف</span>
                                    </label>
                                    <label class="poll-option" style="flex: 1; min-width: 150px; justify-content: center;">
                                        <input type="radio" name="satisfaction" value="1">
                                        <span class="poll-icon">😞</span>
                                        <span>خیلی ضعیف</span>
                                    </label>
                                </div>
                            </div>

                            <!-- سوال 2: مفیدترین بخش -->
                            <div class="survey-question">
                                <h3 style="color: var(--primary); margin-bottom: 1rem;">
                                    <i class="fas fa-lightbulb"></i> کدام بخش برای شما مفیدتر بود؟
                                </h3>
                                <select name="most_useful" required style="padding: 1rem; background: var(--card-bg); color: var(--text-light); border: 1px solid var(--card-border); border-radius: 8px; font-size: 1rem; font-family: 'Vazirmatn', sans-serif;">
                                    <option value="">انتخاب کنید...</option>
                                    <option value="theory">مبانی نظری</option>
                                    <option value="practical">نمونه‌های عملی</option>
                                    <option value="code">کدهای نمونه</option>
                                    <option value="applications">کاربردها</option>
                                    <option value="implementation">مهندسی نرم‌افزار</option>
                                </select>
                            </div>

                            <!-- سوال 3: آیا رگرسیون کوانتایل را استفاده خواهید کرد؟ -->
                            <div class="survey-question">
                                <h3 style="color: var(--primary); margin-bottom: 1rem;">
                                    <i class="fas fa-code"></i> آیا قصد دارید از رگرسیون کوانتایل در پروژه‌های خود استفاده کنید؟
                                </h3>
                                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                    <label class="poll-option" style="flex: 1;">
                                        <input type="radio" name="will_use" value="yes" required style="margin-left: 0.5rem;">
                                        <span class="poll-icon">✅</span>
                                        <span>بله، حتماً</span>
                                    </label>
                                    <label class="poll-option" style="flex: 1;">
                                        <input type="radio" name="will_use" value="maybe">
                                        <span class="poll-icon">🤔</span>
                                        <span>احتمالاً</span>
                                    </label>
                                    <label class="poll-option" style="flex: 1;">
                                        <input type="radio" name="will_use" value="no">
                                        <span class="poll-icon">❌</span>
                                        <span>خیر</span>
                                    </label>
                                </div>
                            </div>

                            <!-- سوال 4: نظرات و پیشنهادات -->
                            <div class="survey-question">
                                <h3 style="color: var(--primary); margin-bottom: 1rem;">
                                    <i class="fas fa-comment"></i> نظرات و پیشنهادات شما:
                                </h3>
                                <textarea name="comments" rows="4" placeholder="نظرات، پیشنهادات یا انتقادات خود را اینجا بنویسید..." style="width: 100%; padding: 1rem; background: var(--card-bg); color: var(--text-light); border: 1px solid var(--card-border); border-radius: 8px; font-size: 1rem; font-family: 'Vazirmatn', sans-serif; resize: vertical;"></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary" style="padding: 1rem 2rem; font-size: 1.1rem; align-self: center;">
                                <i class="fas fa-paper-plane"></i> ارسال نظرسنجی
                            </button>
                        </form>

                        <div id="surveyThankYou" style="display: none; text-align: center; padding: 3rem;">
                            <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success); margin-bottom: 1rem;"></i>
                            <h2 style="color: var(--success); margin-bottom: 1rem;">با تشکر از شما!</h2>
                            <p style="font-size: 1.1rem;">نظرات شما با موفقیت ثبت شد. از وقتی که گذاشتید سپاسگزاریم.</p>
                            
                            <div id="surveyResults" style="margin-top: 3rem; text-align: right;">
                                <h3 style="color: var(--primary); margin-bottom: 1.5rem;">
                                    <i class="fas fa-chart-bar"></i> نتایج نظرسنجی تا کنون:
                                </h3>
                                <div id="resultsContent"></div>
                            </div>
                        </div>
                    </div>
                `,
                notes: {
                    content: "نظرسنجی از مخاطبین. اجازه دهید آزادانه نظر بدهند. نتایج در localStorage ذخیره می‌شود.",
                    timing: "3 دقیقه",
                    tips: "به مخاطبین بگویید نظرشان برای شما ارزشمند است."
                }
            }
        ];

        // ==================== STATE MANAGEMENT ====================
        let currentSlide = 0;
        let timerInterval = null;
        let timerSeconds = 0;
        let isFullscreen = false;
        let laserActive = false;
        let penActive = false;
        let eraserActive = false;
        let drawingContext = null;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        // ==================== INITIALIZATION ====================
        function init() {
            renderSlides();
            updateSlideCounter();
            updateProgressBar();
            initParticles();
            initDrawingCanvas();
            setupKeyboardShortcuts();
            updateBreadcrumb();
            generateOverview();
            
            // Listen for slide changes to init survey
            document.addEventListener('slideChanged', initSurvey);
        }

        function renderSlides() {
            const container = document.getElementById('slideContainer');
            container.innerHTML = '';
            
            slidesData.forEach((slide, index) => {
                const slideDiv = document.createElement('div');
                slideDiv.className = `slide ${index === 0 ? 'active' : ''}`;
                slideDiv.id = `slide-${slide.id}`;
                slideDiv.innerHTML = slide.content;
                container.appendChild(slideDiv);
            });
        }

        // ==================== NAVIGATION ====================
        function nextSlide() {
            if (currentSlide < slidesData.length - 1) {
                changeSlide(currentSlide + 1);
            }
        }

        function previousSlide() {
            if (currentSlide > 0) {
                changeSlide(currentSlide - 1);
            }
        }

        function changeSlide(newIndex) {
            const slides = document.querySelectorAll('.slide');
            slides[currentSlide].classList.remove('active');
            slides[currentSlide].classList.add('prev');
            
            setTimeout(() => {
                slides[currentSlide].classList.remove('prev');
            }, 600);
            
            currentSlide = newIndex;
            slides[currentSlide].classList.add('active');
            
            updateSlideCounter();
            updateProgressBar();
            updateBreadcrumb();
            updateSpeakerNotes();
            
            // Trigger custom event for specific slide logic
            document.dispatchEvent(new Event('slideChanged'));
            
            // Initialize survey if we land on slide 35 (index 34)
            if (currentSlide === 34) {
                setTimeout(initSurvey, 500);
            }
        }

        function updateSlideCounter() {
            document.getElementById('currentSlide').textContent = currentSlide + 1;
            document.getElementById('totalSlides').textContent = slidesData.length;
        }

        function updateProgressBar() {
            const progress = ((currentSlide + 1) / slidesData.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function updateBreadcrumb() {
            const slide = slidesData[currentSlide];
            document.getElementById('breadcrumbPath').textContent = slide.title;
        }

        function progressBarClick(event) {
            const progressBar = event.currentTarget;
            const clickX = event.clientX - progressBar.getBoundingClientRect().left;
            const width = progressBar.offsetWidth;
            const clickPercent = clickX / width;
            const targetSlide = Math.floor(clickPercent * slidesData.length);
            changeSlide(Math.max(0, Math.min(targetSlide, slidesData.length - 1)));
        }

        // ==================== SPEAKER NOTES ====================
        function toggleSpeakerNotes() {
            const notes = document.getElementById('speakerNotes');
            notes.classList.toggle('active');
            if (notes.classList.contains('active')) {
                updateSpeakerNotes();
            }
        }

        function updateSpeakerNotes() {
            const slide = slidesData[currentSlide];
            if (slide.notes) {
                document.getElementById('notesContent').textContent = slide.notes.content;
                document.getElementById('notesTiming').innerHTML = `<i class="fas fa-clock"></i> ${slide.notes.timing}`;
                document.getElementById('notesTips').innerHTML = `<i class="fas fa-lightbulb"></i> ${slide.notes.tips}`;
            }
        }

        // ==================== TIMER ====================
        function toggleTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            } else {
                timerInterval = setInterval(() => {
                    timerSeconds++;
                    const minutes = Math.floor(timerSeconds / 60);
                    const seconds = timerSeconds % 60;
                    document.getElementById('timerDisplay').textContent = 
                        `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }, 1000);
            }
        }

        // ==================== LASER POINTER ====================
        function toggleLaser() {
            laserActive = !laserActive;
            const laser = document.getElementById('laserPointer');
            const btn = document.getElementById('laserBtn');
            
            if (laserActive) {
                laser.style.display = 'block';
                btn.classList.add('active');
                document.body.style.cursor = 'none';
                document.addEventListener('mousemove', moveLaser);
            } else {
                laser.style.display = 'none';
                btn.classList.remove('active');
                document.body.style.cursor = 'default';
                document.removeEventListener('mousemove', moveLaser);
            }
        }

        function moveLaser(e) {
            const laser = document.getElementById('laserPointer');
            laser.style.left = `${e.clientX - 7.5}px`;
            laser.style.top = `${e.clientY - 7.5}px`;
        }

        // ==================== DRAWING (PEN & ERASER) - FIXED ====================
        function initDrawingCanvas() {
            const canvas = document.getElementById('drawingCanvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            drawingContext = canvas.getContext('2d');
            drawingContext.lineWidth = 3;
            drawingContext.lineCap = 'round';
            drawingContext.strokeStyle = '#ef4444';

            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
        }

        function togglePen() {
            penActive = !penActive;
            const canvas = document.getElementById('drawingCanvas');
            const btn = document.getElementById('penBtn');
            
            if (penActive) {
                // Turn OFF eraser if it was on
                if (eraserActive) {
                    eraserActive = false;
                    document.getElementById('eraserBtn').classList.remove('active');
                }
                canvas.style.display = 'block';
                btn.classList.add('active');
                drawingContext.globalCompositeOperation = 'source-over';
                drawingContext.strokeStyle = '#ef4444';
            } else {
                canvas.style.display = 'none';
                btn.classList.remove('active');
            }
        }

        function toggleEraser() {
            eraserActive = !eraserActive;
            const canvas = document.getElementById('drawingCanvas');
            const btn = document.getElementById('eraserBtn');
            
            if (eraserActive) {
                // Turn OFF pen if it was on
                if (penActive) {
                    penActive = false;
                    document.getElementById('penBtn').classList.remove('active');
                }
                canvas.style.display = 'block';
                btn.classList.add('active');
                drawingContext.globalCompositeOperation = 'destination-out';
                drawingContext.lineWidth = 20;
            } else {
                canvas.style.display = 'none';
                btn.classList.remove('active');
                drawingContext.globalCompositeOperation = 'source-over';
                drawingContext.lineWidth = 3;
            }
        }

        function startDrawing(e) {
            if (!penActive && !eraserActive) return;
            isDrawing = true;
            [lastX, lastY] = [e.clientX, e.clientY];
        }

        function draw(e) {
            if (!isDrawing) return;
            drawingContext.beginPath();
            drawingContext.moveTo(lastX, lastY);
            drawingContext.lineTo(e.clientX, e.clientY);
            drawingContext.stroke();
            [lastX, lastY] = [e.clientX, e.clientY];
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function clearDrawing() {
            const canvas = document.getElementById('drawingCanvas');
            drawingContext.clearRect(0, 0, canvas.width, canvas.height);
        }

        // ==================== FULLSCREEN ====================
        function toggleFullscreen() {
            if (!isFullscreen) {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
            isFullscreen = !isFullscreen;
        }

        // ==================== REFERENCES MODAL ====================
        function openReferences() {
            document.getElementById('referencesModal').classList.add('active');
        }

        function closeReferences() {
            document.getElementById('referencesModal').classList.remove('active');
        }

        // ==================== OVERVIEW MODAL ====================
        function toggleOverview() {
            const modal = document.getElementById('overviewModal');
            modal.classList.toggle('active');
        }

        function generateOverview() {
            const grid = document.getElementById('overviewGrid');
            grid.innerHTML = '';
            slidesData.forEach((slide, index) => {
                const item = document.createElement('div');
                item.className = `overview-item ${index === currentSlide ? 'active' : ''}`;
                item.textContent = `${index + 1}. ${slide.title}`;
                item.onclick = () => {
                    changeSlide(index);
                    toggleOverview();
                };
                grid.appendChild(item);
            });
        }

        // ==================== SURVEY FUNCTIONALITY ====================
        function initSurvey() {
            const form = document.getElementById('surveyForm');
            if (!form) return;
            
            // Prevent multiple bindings
            if (form.dataset.bound) return;
            form.dataset.bound = "true";

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = {
                    satisfaction: form.satisfaction.value,
                    most_useful: form.most_useful.value,
                    will_use: form.will_use.value,
                    comments: form.comments.value,
                    timestamp: new Date().toISOString()
                };

                // ذخیره در localStorage
                let surveys = JSON.parse(localStorage.getItem('quantileRegressionSurveys') || '[]');
                surveys.push(formData);
                localStorage.setItem('quantileRegressionSurveys', JSON.stringify(surveys));

                // نمایش پیام تشکر و نتایج
                form.style.display = 'none';
                document.getElementById('surveyThankYou').style.display = 'block';
                
                displaySurveyResults();
            });
        }

        function displaySurveyResults() {
            const surveys = JSON.parse(localStorage.getItem('quantileRegressionSurveys') || '[]');
            const resultsDiv = document.getElementById('resultsContent');
            
            if (surveys.length === 0) {
                resultsDiv.innerHTML = '<p>هنوز نظری ثبت نشده است.</p>';
                return;
            }

            // محاسبه آمار
            const avgSatisfaction = (surveys.reduce((sum, s) => sum + parseInt(s.satisfaction), 0) / surveys.length).toFixed(1);
            
            const usefulCounts = {};
            surveys.forEach(s => {
                usefulCounts[s.most_useful] = (usefulCounts[s.most_useful] || 0) + 1;
            });

            const willUseCounts = {};
            surveys.forEach(s => {
                willUseCounts[s.will_use] = (willUseCounts[s.will_use] || 0) + 1;
            });

            const usefulLabels = {
                'theory': 'مبانی نظری',
                'practical': 'نمونه‌های عملی',
                'code': 'کدهای نمونه',
                'applications': 'کاربردها',
                'implementation': 'مهندسی نرم‌افزار'
            };

            const willUseLabels = {
                'yes': 'بله، حتماً',
                'maybe': 'احتمالاً',
                'no': 'خیر'
            };

            let html = `
                <div class="grid-2" style="gap: 2rem;">
                    <div class="info-box">
                        <h4><i class="fas fa-star"></i> میانگین رضایت:</h4>
                        <p style="font-size: 2rem; font-weight: 700; color: var(--success);">${avgSatisfaction} / 5</p>
                        <p style="font-size: 0.9rem; opacity: 0.7;">از ${surveys.length} نفر</p>
                    </div>
                    
                    <div class="info-box">
                        <h4><i class="fas fa-lightbulb"></i> مفیدترین بخش:</h4>
                        ${Object.entries(usefulCounts).map(([key, count]) => `
                            <div style="margin: 0.5rem 0; display: flex; justify-content: space-between; align-items: center;">
                                <span>${usefulLabels[key] || key}</span>
                                <span style="background: var(--primary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.9rem;">${count}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="info-box" style="margin-top: 1rem;">
                    <h4><i class="fas fa-code"></i> قصد استفاده:</h4>
                    ${Object.entries(willUseCounts).map(([key, count]) => `
                        <div style="margin: 0.5rem 0; display: flex; justify-content: space-between; align-items: center;">
                            <span>${willUseLabels[key] || key}</span>
                            <span style="background: var(--secondary); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.9rem;">${count}</span>
                        </div>
                    `).join('')}
                </div>
            `;
            resultsDiv.innerHTML = html;
        }

        // ==================== PARTICLES BACKGROUND ====================
        function initParticles() {
            const canvas = document.getElementById('particleCanvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const ctx = canvas.getContext('2d');
            const particles = [];
            const particleCount = 50;

            for (let i = 0; i < particleCount; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.5,
                    vy: (Math.random() - 0.5) * 0.5,
                    radius: Math.random() * 2 + 1
                });
            }

            function animateParticles() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'rgba(59, 130, 246, 0.5)';
                
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    
                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
                    
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                requestAnimationFrame(animateParticles);
            }
            
            animateParticles();
        }

        // ==================== KEYBOARD SHORTCUTS ====================
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'ArrowRight':
                    case ' ':
                        e.preventDefault();
                        nextSlide();
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        previousSlide();
                        break;
                    case 'f':
                    case 'F':
                        toggleFullscreen();
                        break;
                    case 'n':
                    case 'N':
                        toggleSpeakerNotes();
                        break;
                    case 't':
                    case 'T':
                        toggleTimer();
                        break;
                    case 'l':
                    case 'L':
                        toggleLaser();
                        break;
                    case 'p':
                    case 'P':
                        togglePen();
                        break;
                    case 'e':
                    case 'E':
                        toggleEraser();
                        break;
                    case 'c':
                    case 'C':
                        clearDrawing();
                        break;
                    case 'o':
                    case 'O':
                        toggleOverview();
                        break;
                    case 'r':
                    case 'R':
                        openReferences();
                        break;
                    case 'Escape':
                        closeReferences();
                        toggleOverview();
                        break;
                }
            });
        }

        // ==================== HISTORY TAB SWITCHER (FOR SLIDE 9) ====================
        function switchHistoryTab(tab) {
            const historyContent = document.getElementById('historyContent');
            const peopleContent = document.getElementById('peopleContent');
            const historyBtn = document.getElementById('historyTabBtn');
            const peopleBtn = document.getElementById('peopleTabBtn');
            
            if (tab === 'history') {
                historyContent.style.display = 'block';
                peopleContent.style.display = 'none';
                historyBtn.style.background = 'linear-gradient(135deg, var(--primary), var(--secondary))';
                historyBtn.style.color = 'white';
                historyBtn.style.border = 'none';
                peopleBtn.style.background = 'rgba(255,255,255,0.05)';
                peopleBtn.style.color = 'var(--text-light)';
                peopleBtn.style.border = '1px solid var(--card-border)';
            } else {
                historyContent.style.display = 'none';
                peopleContent.style.display = 'block';
                peopleBtn.style.background = 'linear-gradient(135deg, var(--primary), var(--secondary))';
                peopleBtn.style.color = 'white';
                peopleBtn.style.border = 'none';
                historyBtn.style.background = 'rgba(255,255,255,0.05)';
                historyBtn.style.color = 'var(--text-light)';
                historyBtn.style.border = '1px solid var(--card-border)';
            }
        }

        // ==================== START APPLICATION ====================
        window.addEventListener('load', () => {
            init();
            // Render LaTeX formulas
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "$$", right: "$$", display: true},
                    {left: "$", right: "$", display: false},
                    {left: "\\(", right: "\\)", display: false},
                    {left: "\\[", right: "\\]", display: true}
                ]
            });
        });

        window.addEventListener('resize', () => {
            const particleCanvas = document.getElementById('particleCanvas');
            particleCanvas.width = window.innerWidth;
            particleCanvas.height = window.innerHeight;
            
            const drawingCanvas = document.getElementById('drawingCanvas');
            drawingCanvas.width = window.innerWidth;
            drawingCanvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
